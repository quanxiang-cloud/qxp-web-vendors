System.register(["react","@one-for-all/utils","history","rxjs","rxjs/operators","rxjs/ajax","react-dom"],(function(e){"use strict";var t,r,n,o,a,c,s,i,l,p,u,d,f,h,b,y,m,v,g,S,j,x,O,$,w,k,P,E,I,N,_,H,D,A;return{setters:[function(e){t=e.default,r=e.useRef,n=e.useState,o=e.useEffect,a=e.useMemo,c=e.useContext,s=e.useImperativeHandle},function(e){i=e.logger},function(e){l=e.createBrowserHistory},function(e){p=e.switchMap,u=e.share,d=e.map,f=e.catchError,h=e.of,b=e.BehaviorSubject,y=e.Subject,m=e.merge,v=e.noop,g=e.from,S=e.firstValueFrom,j=e.combineLatest,x=e.take,O=e.last,$=e.skip,w=e.tap,k=e.distinctUntilKeyChanged,P=e.distinctUntilChanged},function(e){E=e.map,I=e.filter,N=e.share,_=e.skip,H=e.delay},function(e){D=e.ajax},function(e){A=e.default}],execute:function(){e({useBootResult:xt,useNodeComponent:ct});var C=t.createContext("ROOT"),L=Object.defineProperty,R=Object.defineProperties,F=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,z=(e,t,r)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var T=function(e){return new Proxy({},{get:(t,r)=>{const n=e.getState$(r).getValue();return o=((e,t)=>{for(var r in t||(t={}))K.call(t,r)&&z(e,r,t[r]);if(V)for(var r of V(t))U.call(t,r)&&z(e,r,t[r]);return e})({},n),R(o,F({refresh:()=>e.refresh(r),fetch:(t,n)=>{e.fetch(r,{params:t,callback:n})},rawFetch:(t,n)=>{e.rawFetch(r,t)}}));var o}})};function W(e){return"[object Object]"===Object.prototype.toString.call(e)}function q(e,t){if("expression"in e&&"state_convert_expression"===e.type)return function(e,t){try{const r=new Function("state",`return ${e}`).bind(t);return r.toString=()=>["","function wrappedStateConvertor(state) {",`\treturn ${e}`,"}"].join("\n"),r}catch(t){throw new Error(["failed to instantiate state convert expression:","\n",e,"\n",t].join(""))}}(e.expression,t);try{const r=new Function(e.args,e.body).bind(t);return r.toString=()=>["",`function wrappedFunc(${e.args}) {`,`\t${e.body}`,"}",""].join("\n"),r}catch(t){throw new Error(["failed to instantiate function of following spec:","\n","spec.args:",e.args,"\n","spec.body:","\n",e.body,"\n",t].join(""))}}var B=function e(t,r){return W(t)&&"object"==typeof t&&null!==t?(Object.entries(t).forEach((([n,o])=>{!function(e){return!(!W(e)||"object"!=typeof e||null===e)&&("type"in e&&"state_convert_expression"===Reflect.get(e,"type")||3===Object.keys(e).length&&"type"in e&&"args"in e&&"body"in e)}(o)?W(o)?Reflect.set(t,n,e(o,r)):Array.isArray(o)&&Reflect.set(t,n,o.map((t=>e(t,r)))):Reflect.set(t,n,q(o,r))})),t):t};var X=function(e,t){try{return window.structuredClone?B(window.structuredClone(e),t):B(JSON.parse(JSON.stringify(e)),t)}catch(e){return i.error("deserialize failed:",e),null}};function M(e){return D(e).pipe(d((({response:e})=>({result:e,error:void 0}))),f((e=>h({error:e,data:void 0}))))}var J=Object.defineProperty,Z=Object.defineProperties,G=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertySymbols,Y=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable,te=(e,t,r)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,re=(e,t)=>{for(var r in t||(t={}))Y.call(t,r)&&te(e,r,t[r]);if(Q)for(var r of Q(t))ee.call(t,r)&&te(e,r,t[r]);return e},ne=(e,t)=>Z(e,G(t));const oe={result:void 0,error:void 0,loading:!1};var ae=function(e,t){const r=new b(oe),n=function(e){return e.pipe(p(M),u())}(e);return n.pipe(E((({result:e,error:t})=>({result:e,error:t,loading:!1}))),E((e=>{if(!t)return e;const r=t({body:e.result,error:e.error});return ne(re({},r),{loading:e.loading})}))).subscribe(r),e.pipe(I((()=>!1===r.getValue().loading)),E((()=>ne(re({},r.getValue()),{loading:!0})))).subscribe(r),r},ce=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var le=function(e,t){const r=new y,n=new y,o=n.pipe(E((r=>t.build(e,r))),I(Boolean),N());let a;const c=ae(m(o,r),t.responseAdapter);return c.pipe(_(1),I((({loading:e})=>!e)),H(10)).subscribe((e=>{var t;null==(t=null==a?void 0:a.callback)||t.call(a,e)})),{state$:c,fetch:e=>{a=e,n.next(e.params)},rawFetch:e=>{var t=e,{callback:n}=t,o=((e,t)=>{var r={};for(var n in e)se.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&ce)for(var n of ce(e))t.indexOf(n)<0&&ie.call(e,n)&&(r[n]=e[n]);return r})(t,["callback"]);a={callback:n},r.next(o)},refresh:()=>{a&&(a={params:a.params},n.next(a.params))}}};const pe={state$:new b(oe),fetch:v,rawFetch:v,refresh:v},ue={build:()=>({url:"/api",method:"get"})};class de{constructor({apiStateSpec:e,apiSpecAdapter:t,parentHub:r}){this.parentHub=void 0,this.parentHub=r,this.cache=Object.entries(e).reduce(((e,[r,{apiID:n}])=>(e[r]=le(n,t||ue),e)),{})}hasState$(e){var t;return!!this.cache[e]||!!(null==(t=this.parentHub)?void 0:t.hasState$(e))}findState$(e){var t;return this.cache[e]?this.cache[e]:null==(t=this.parentHub)?void 0:t.findState$(e)}getState$(e){const{state$:t}=this.findState$(e)||{};return t||(i.error([`can't find api state: ${e}, please check apiStateSpec or parent schema.`,"In order to prevent UI crash, a dummyState$ will be returned."].join(" ")),pe.state$)}fetch(e,t){const{fetch:r}=this.findState$(e)||{};r?r(t):i.error([`can't find api state: ${e}, please check apiStateSpec or parent schema,`,"this fetch action will be ignored."].join(" "))}rawFetch(e,t){const{rawFetch:r}=this.findState$(e)||{};r&&r(t),i.error([`can't find api state: ${e}, please check apiStateSpec or parent schema,`,"this fetch action will be ignored."].join(" "))}refresh(e){const{refresh:t}=this.findState$(e)||{};t?t():i.error([`can't find api state: ${e}, please check apiStateSpec or parent schema,`,"this refresh action will be ignored."].join(" "))}}var fe=function(e){return new Proxy({},{get:(t,r)=>e.getState$(r).value,set:(t,r,n)=>r.startsWith("$")?(i.error("node internal state can not be assigned"),!1):(e.mutateState(r,n),!0)})};class he{constructor(e,t){this.parentHub=void 0,this.unWriteableStates=[],this.parentHub=t,this.cache=Object.entries(e).reduce(((e,[t,{initial:r,writeable:n}])=>(e[t]=new b(r),!1===n&&this.unWriteableStates.push(t),e)),{})}hasState$(e){var t;return!!this.cache[e]||!!(null==(t=this.parentHub)?void 0:t.hasState$(e))}_createState$(e,t){this.cache[e]=new b(t)}findState$(e){var t;return this.cache[e]?this.cache[e]:null==(t=this.parentHub)?void 0:t.findState$(e)}getState$(e){const t=this.findState$(e);return t||(this._createState$(e),this.cache[e])}mutateState(e,t){e.startsWith("$")?i.warn("shared stateID can not starts with $, this action will be ignored"):this.unWriteableStates.includes(e)?i.warn("this shared state is not allowed to be written, this action will be ignored"):this.getState$(e).next(t)}getNodeState$(e){const t=`$${e}`;return this.getState$(t)}exposeNodeState(e,t){const r=`$${e}`;this.cache[r]?this.cache[r].next(t):this._createState$(r,t)}}var be=Object.defineProperty,ye=Object.defineProperties,me=Object.getOwnPropertyDescriptors,ve=Object.getOwnPropertySymbols,ge=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable,je=(e,t,r)=>t in e?be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;function xe(e,t,r){const{state$:n,fetch:o}=le(t,e),a=n.pipe(x(2),O(),d((({result:e})=>e)));return o({params:r}),a}function Oe(e,t,r){return e.map((({stateID:e,func:n,dependencies:o})=>{const a=function(e,t,r){const n=Object.entries(e).map((([e,n])=>{if(!t[e])return void i.error(`no state: ${e} found in APIStatesSpec, undefined will be used as this dependency value`);const{apiID:o}=t[e];return[e,xe(r,o,n)]})).filter((e=>!!e)).reduce(((e,[t,r])=>(e[t]=r,e)),{});return Object.keys(n).length?j(n):h({})}(o||{},t,r),c=a.pipe(p((e=>g(function(e){return t=>Promise.resolve((()=>{try{return e(t)}catch(e){return}})())}(n)(e)))));return[e,c]})).reduce(((e,[t,r])=>(e[t]=r,e)),{})}function $e(e){return Object.entries(e).map((([e,{initializer:t}])=>{if(t)return r=((e,t)=>{for(var r in t||(t={}))ge.call(t,r)&&je(e,r,t[r]);if(ve)for(var r of ve(t))Se.call(t,r)&&je(e,r,t[r]);return e})({},t),ye(r,me({stateID:e}));var r})).filter((e=>!!e))}var we=async function(e,t,r){if(!r)return e;const n=Oe($e(e),t,r);if(!Object.keys(n).length)return e;const o=await S(j(n));return Object.entries(o).forEach((([t,r])=>{e[t].initial=r})),e};function ke(e,t){var r;const n=e.props||{};return Object.values(n).forEach((e=>{"inherited_property"===e.type&&e.parentID&&t.add(e.parentID)})),"children"in e&&(null==(r=e.children)||r.forEach((e=>ke(e,t)))),"node"in e&&ke(e.node,t),t}const Pe=["dummyLoopContainer","placeholder-node"];var Ee=class{constructor(e){this.cache={},this.cacheIDs=e}shouldCache(e){return this.cacheIDs.has(e)}initState(e){this.cache[e]||(this.cache[e]=new b({}))}getProps$(e){return this.initState(e),this.cache[e]}setProps(e,t,r){const n=function(e){return e.replace(/\/(.+)\/[0-9]+/g,"/$1").split("/").pop()}(e);n&&!Pe.includes(t)&&this.shouldCache(n)&&(this.cache[n]?this.cache[n].next(r):this.cache[n]=new b(r))}};async function Ie({artery:e,parentCTX:t,plugins:r}){const{apiStateSpec:n,sharedStatesSpec:o}=e,a=Object.assign({},(null==t?void 0:t.plugins)||{},r||{}),c=new de({apiSpecAdapter:a.apiSpecAdapter,apiStateSpec:n||{},parentHub:null==t?void 0:t.statesHubAPI}),s=X(o||{},void 0),i=await we(s||{},n||{},a.apiSpecAdapter),p=new he(i,null==t?void 0:t.statesHubShared),u=(null==t?void 0:t.history)||l(),d=(null==t?void 0:t.location$)||new b(u.location);(null==t?void 0:t.location$)||u.listen((({location:e})=>{d.next(e)}));const f=ke(e.node,new Set),h=new Ee(f);return{statesHubAPI:c,statesHubShared:p,apiStates:T(c),states:fe(p),history:u,location$:d,nodePropsCache:h,plugins:a}}var Ne=e("bootUp",(async function({artery:e,parentCTX:t,plugins:r}){const n=await Ie({artery:e,parentCTX:t,plugins:r}),o=function(e,t){const r=X(e,{apiStates:t.apiStates,states:t.states,history:t.history});if(!r)throw new Error("failed to init ctx!");return r}(e.node,n);return{ctx:n,rootNode:o}}));var _e=Object.defineProperty,He=Object.defineProperties,De=Object.getOwnPropertyDescriptors,Ae=Object.getOwnPropertySymbols,Ce=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable,Re=(e,t,r)=>t in e?_e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Fe=(e,t)=>{for(var r in t||(t={}))Ce.call(t,r)&&Re(e,r,t[r]);if(Ae)for(var r of Ae(t))Le.call(t,r)&&Re(e,r,t[r]);return e},Ve=(e,t)=>He(e,De(t));function Ke({state:e,convertor:t,fallback:r,propName:n}){var o;if(t&&void 0!==e)try{return null!=(o=t(e))?o:r}catch(o){return i.error(`an error occurred while calling state convertor for prop: "${n}"`,"with the following state and convertor:","\n",e,"\n",t.toString(),"\n","So return fallback instead, fallback:",r,"\n","\n",o),r}return null!=e?e:r}var Ue=function(e,t){const a={},c={},s={};Object.entries(e.props||{}).filter((e=>"api_result_property"===e[1].type)).forEach((([e,{fallback:r,convertor:n,stateID:o}])=>{s[e]=r,a[e]=n,c[e]=t.statesHubAPI.getState$(o)}));const i=r(s),[l,p]=n((()=>Object.entries(c).reduce(((e,[t,r])=>(e[t]=Ke({state:r.getValue().result,convertor:a[t],fallback:i.current[t],propName:t}),e)),{})));return o((()=>{const e=Object.entries(c).reduce(((e,[t,r])=>(e[t]=r.pipe(k("result"),d((({result:e})=>Ke({state:e,convertor:a[t],fallback:i.current[t],propName:t}))),w((e=>{i.current[t]=e}))),e)),{}),t=j(e).pipe($(1)).subscribe(p);return()=>t.unsubscribe()}),[]),l};var ze=function(e,t){const r={};Object.entries(e.props||{}).filter((e=>"api_loading_property"===e[1].type)).forEach((([e,{stateID:n}])=>{r[e]=t.statesHubAPI.getState$(n)}));const[a,c]=n((()=>Object.entries(r).reduce(((e,[t,r])=>(e[t]=r.getValue().loading,e)),{})));return o((()=>{const e=Object.entries(r).reduce(((e,[t,r])=>(e[t]=r.pipe($(1),k("loading"),d((({loading:e})=>e))),e)),{}),t=j(e).subscribe(c);return()=>t.unsubscribe()}),[]),a};var Te=function(e,t){const a={},c={},s={};Object.entries(e.props||{}).filter((e=>"shared_state_property"===e[1].type||"node_state_property"===e[1].type)).forEach((([e,r])=>{"shared_state_property"===r.type?(c[e]=t.statesHubShared.getState$(r.stateID),a[e]=r.convertor):(c[e]=t.statesHubShared.getNodeState$(r.nodePath),a[e]=r.convertor),s[e]=r.fallback}));const i=r(s),[l,p]=n((()=>Object.entries(c).reduce(((e,[t,r])=>(e[t]=Ke({state:r.getValue(),convertor:a[t],fallback:i.current[t],propName:t}),e)),{})));return o((()=>{if(!Object.keys(c).length)return;const e=Object.entries(c).reduce(((e,[t,r])=>(e[t]=r.pipe(P(),d((e=>Ke({state:e,convertor:a[t],fallback:i.current[t],propName:t}))),w((e=>{i.current[t]=e}))),e)),{}),t=j(e).pipe($(1)).subscribe(p);return()=>t.unsubscribe()}),[]),l};var We=function(e,t){return a((()=>e.props?Object.entries(e.props).filter((e=>"shared_state_mutation_property"===e[1].type)).reduce(((e,[r,{stateID:n,convertor:o}])=>(e[r]=function(e){if("function"==typeof o)try{const r=o(e);t.statesHubShared.mutateState(n,r)}catch(e){i.error("failed to run convertor:\n",o.toString(),"\n",e)}else t.statesHubShared.mutateState(n,e)},e)),{}):{}),[])};var qe=function(e,t){const r=c(C);return a((()=>"supportStateExposure"in e&&e.supportStateExposure?{__exposeState:n=>{t.statesHubShared.exposeNodeState(`${r}/${e.id}`,n)}}:{}),[])};var Be=function({props:e},r){return a((()=>Object.entries(e||{}).filter((e=>"render_property"===e[1].type)).reduce(((e,[n,{adapter:o,node:a}])=>(e[n]=function(e,r,n){return(...o)=>{let a={};try{const e=(null==n?void 0:n(...o))||{};"object"==typeof e?a=Object.entries(e).reduce(((e,[t,r])=>(e[t]={type:"constant_property",value:r},e)),{}):i.error("toProps result is no Object")}catch(e){i.error("failed to call toProps",e)}return e.props=Object.assign({},e.props,a),t.createElement(jt,{node:e,ctx:r})}}(a,r,o),e)),{})),[])};function Xe(e,t){const r={};Object.entries(e.props||{}).filter((e=>"computed_property"===e[1].type)).forEach((([e,{deps:n,convertor:o,fallback:a}])=>{r[e]=function({propName:e,deps:t,convertor:r,ctx:n,fallback:o}){let a=o;const c=t.map((({type:e,depID:t})=>"api_state"===e?n.statesHubAPI.getState$(t):"node_state"===e?n.statesHubShared.getNodeState$(t):n.statesHubShared.getState$(t))),s=c.reduce(((e,r,n)=>Ve(Fe({},e),{[t[n].depID]:r.value})),{}),i=new b(Ke({state:s,convertor:r,fallback:o,propName:e}));return j(c).pipe(d((n=>Ke({state:n.reduce(((e,r,n)=>Ve(Fe({},e),{[t[n].depID]:r})),{}),convertor:r,fallback:a,propName:e}))),$(1),w((e=>{a=e}))).subscribe((e=>i.next(e))),i}({propName:e,deps:n,convertor:o,ctx:t,fallback:a})}));const[a,c]=n((()=>Object.entries(r).reduce(((e,[t,r])=>(e[t]=r.value,e)),{})));return o((()=>{const e=j(r).pipe($(1)).subscribe(c);return()=>e.unsubscribe()}),[]),a}var Me=function(e,t){const a={},c={},s={};Object.entries(e.props||{}).filter((e=>"inherited_property"===e[1].type)).forEach((([e,{fallback:r,convertor:n,parentID:o}])=>{var i;s[e]=r,a[e]=n,c[e]=null==(i=t.nodePropsCache)?void 0:i.getProps$(o)}));const i=r(s),[l,p]=n((()=>Object.entries(c).reduce(((e,[t,r])=>r?(e[t]=Ke({state:null==r?void 0:r.getValue(),convertor:a[t],fallback:i.current[t],propName:t}),e):(e[t]=i.current[t],e)),{})));return o((()=>{const e=Object.entries(c).reduce(((e,[t,r])=>r?(e[t]=r.pipe(d((e=>Ke({state:e,convertor:a[t],fallback:i.current[t],propName:t}))),w((e=>i.current[t]=e))),e):(e[t]=h(i.current[t]),e)),{}),t=j(e).pipe($(1)).subscribe(p);return()=>t.unsubscribe()}),[]),l};var Je=function(e,t){return"isLink"in e&&e.isLink&&"html-element"===e.type&&"a"===e.name?{onClick:e=>{e.stopPropagation(),e.preventDefault();const r=e.currentTarget.href;r&&t.history.push(r)}}:{}};var Ze=e("useInstantiateProps",(function(e,t){const r=c(C),n=function(e){return e.props?Object.entries(e.props).filter((e=>"constant_property"===e[1].type)).reduce(((e,[t,{value:r}])=>(e[t]=r,e)),{}):{}}(e),o=Ue(e,t),s=ze(e,t),l=Te(e,t),p=qe(e,t),u=Xe(e,t),d=Me(e,t),f=function(e){return a((()=>e.props?Object.entries(e.props).filter((e=>"functional_property"===e[1].type)).reduce(((t,[r,{func:n}])=>(t[r]=(...t)=>{try{n(...t)}catch(o){i.error(`an error occurred while run node '${e.id}' functional property:`,r,"with the following arguments:","\n",t,"\n","function is:","\n",n.toString(),"\n",o)}},t)),{}):{}),[])}(e),h=We(e,t),b=function(e,t){return a((()=>e.props?Object.entries(e.props).filter((e=>"api_invoke_property"===e[1].type)).reduce(((e,[r,{stateID:n,paramsBuilder:o,callback:a}])=>(i.warn("hook useAPIInvokeProps has been deprecated, please use hook useFuncProps instead"),e[r]=function(...e){try{const r=(null==o?void 0:o(...e))||{};t.apiStates[n].fetch(r,a)}catch(e){i.log("failed to run convertor or run action:",e)}},e)),{}):{}),[])}(e,t),y=Be(e,t),m=Je(e,t);return a((()=>{var a;const c=Object.assign(n,b,o,s,l,u,h,p,y,m,d);return null==(a=t.nodePropsCache)||a.setProps(r,e.id,c),Object.assign(c,f)}),[o,l,s,u,n])}));function Ge({didMount:e,willUnmount:t}){o((()=>(null==e||e(),()=>{null==t||t()})),[])}var Qe=function({node:e,ctx:r}){const a=Ze(e,r);Ge(e.lifecycleHooks||{});const s=c(C),l=function(){const[e,t]=n(null);return o((()=>{let e=!1;return System.import("react-jsx-parser").then((r=>{e||t((()=>r.default))})).catch((e=>{i.error("failed to load dependance react-jsx-parser:",e)})),()=>{e=!0}})),e}();return e.jsx?l?t.createElement(l,{bindings:a,renderInWrapper:!1,jsx:e.jsx,onError:e=>console.log(e)}):null:(i.error("jsx string is required,",`please check the spec of node: ${s}.`),null)};function Ye({node:e,ctx:r}){Ge(e.lifecycleHooks||{});const a=function({arteryID:e,refLoader:t,orphan:r},a){const[s,l]=n(),p=c(C);return o((()=>{if(!e)return void i.error(`arteryID is required on RefNode, please check the spec for node: ${p}`);if(!t)return void i.error("refLoader is required on RefNode in order to get ref schema and corresponding APISpecAdapter,","please implement refLoader and pass it to parent RenderEngine.",`current RefNode path is: ${p}`);let n,o=!1;return t(e).then((({artery:e,plugins:t})=>{if(!o)return n=e,Ne({plugins:t,artery:e,parentCTX:r?void 0:a})})).then((e=>{e&&n&&l({ctx:e.ctx,rootNode:e.rootNode})})).catch(i.error),()=>{o=!0}}),[]),s}({arteryID:e.arteryID,refLoader:r.plugins.refLoader,orphan:e.orphan},r);return a?t.createElement(jt,{node:a.rootNode,ctx:a.ctx}):e.fallback?t.createElement(jt,{node:e.fallback,ctx:r}):null}var et=function({node:e,ctx:r}){const n=Ze(e,r);Ge(e.lifecycleHooks||{});const o=c(C);return e.name?e.children&&e.children.length?t.createElement(e.name,n,t.createElement(gt,{nodes:e.children||[],ctx:r})):t.createElement(e.name,n):(i.error("name property is required in html node spec,",`please check the spec of node: ${o}.`),null)};function tt(e,t){const r=c(C),n={type:"html-element",id:"dummyLoopContainer",name:"div",props:{iterable:e}},{iterable:o}=Ze(n,t);if(!Array.isArray(o)){const t=r.split("/").pop();return i.error("state is not iterable.",`LoopContainer node [${t}] require a array type state,`,`but got: ${o},`,"please check the follow property spec:\n",e),null}return o}function rt(e,t,r){return"string"==typeof e||"number"==typeof e?e:void 0===e||"function"==typeof e||"boolean"==typeof e?r:"object"==typeof e&&null!==e?Reflect.get(e,t):r}function nt(e,t,r,n){try{const o=r(e,t);return"object"==typeof o||o?o:(i.error("toProps result should be an object, but got: ${toPropsResult},",`please check the toProps spec of node: ${n},`,"the corresponding node will be skipped for render."),null)}catch(t){return i.error("An error occurred while calling toProps with the following parameter:",e,"\n","error:",t,"\n",`please check the toProps spec of node: ${n},`,"the corresponding node will be skipped for render."),null}}var ot=function({iterableState:e,loopKey:r,node:n,ctx:o,toProps:a}){const s=c(C),i=function({iterableState:e,toProps:t,otherProps:r,ctx:n,loopKey:o}){const a=tt(e,n),s=c(C);return a?a.map(((e,n)=>{const a=nt(e,n,t,s);if(!a)return null;const c=Object.entries(a).reduce(((e,[t,r])=>(e[t]={type:"constant_property",value:r},e)),{});return[rt(e,o,n),Object.assign({},r,c)]})).filter((e=>!!e)):null}({iterableState:e,toProps:a,ctx:o,loopKey:r,otherProps:n.props});return i?t.createElement(t.Fragment,null,i.map((([e,r],a)=>{const c=Object.assign({},n,{props:r});return t.createElement(C.Provider,{value:`${s}/${a}`,key:e},t.createElement(jt,{key:e,node:c,ctx:o}))}))):null};function at({packageName:e,exportName:t}){return System.import(e).then((e=>e[t||"default"])).catch((e=>(i.error("failed to load node component,",e),null)))}function ct(e,{repository:t,componentLoader:r}){const a=c(C),[s,l]=n((()=>{if(t)return function(e,{packageName:t,packageVersion:r,exportName:n}){var o;return null==(o=e[`${t}@${r}`])?void 0:o[n||"default"]}(t,e)}));return o((()=>{if(s)return;let t=!1;return(r||at)({packageName:e.packageName,packageVersion:e.packageVersion,exportName:e.exportName}).then((r=>{t||(r?l((()=>r)):i.error(`got empty component for package: ${e.packageName},`,`exportName: ${e.exportName}, version: ${e.packageVersion}`,`please check the spec for node: ${a}.`))})).catch(i.error),()=>{t=!0}}),[s]),s}function st({outLayer:e,ctx:r,children:n}){const o=Ze(e,r);return t.createElement(e.name,o,n)}function it({outLayer:e,ctx:r,children:n}){const o=Ze(e,r),a=ct(e,r.plugins);return Ge(e.lifecycleHooks||{}),a?t.createElement(a,o,n):null}function lt({outLayer:e,ctx:r,children:n}){return"html-element"===(null==e?void 0:e.type)?t.createElement(st,{outLayer:e,ctx:r},n):"react-component"===(null==e?void 0:e.type)?t.createElement(it,{outLayer:e,ctx:r},n):t.createElement(t.Fragment,null,n)}function pt({node:e,composedState:r,ctx:n,index:o}){const s=function(e,t,r,n){const o=c(C);return a((()=>{const a=nt(e,r,t,o),c=Object.entries(a||{}).reduce(((e,[t,r])=>(e[t]={type:"constant_property",value:r},e)),{});return Object.assign({},n,c)}),[e,n])}(r,e.toProps,o,e.props),i=Object.assign({},e,{props:s});return t.createElement(jt,{node:i,ctx:n})}var ut=function({iterableState:e,loopKey:r,node:n,ctx:o}){const a=c(C),s=tt(e,o);return s?t.createElement(t.Fragment,null,s.map(((e,c)=>{const s=rt(e,r,c);return t.createElement(C.Provider,{value:`${a}/${n.id}/${c}`,key:c},t.createElement(lt,{key:s,outLayer:n.outLayer,ctx:o},(n.nodes||n.children).map(((r,n)=>t.createElement(pt,{node:r,composedState:e,ctx:o,index:n,key:r.id})))))}))):null};var dt=function({node:e,ctx:r}){Ge(e.lifecycleHooks||{});const{node:n}=e;return"composed-node"!==n.type&&"toProps"in e?t.createElement(ot,{iterableState:e.iterableState,loopKey:e.loopKey,node:n,toProps:t=>e.toProps(t),ctx:r}):"composed-node"===n.type?t.createElement(ut,{iterableState:e.iterableState,loopKey:e.loopKey,node:n,ctx:r}):(i.error("Unrecognized loop node:",e),null)};var ft=t.createContext("/");function ht(e){return e.replace(/^\/|\/$/g,"")}function bt(e){return/^:[a-zA-Z_][[a-zA-Z_$0-9]+$/.test(e)}var yt=function(e,t,r){const[a,c]=n(!1);return o((()=>{const n=e.pipe(d((({pathname:e})=>r?function(e,t){const r=e.split("/"),n=t.split("/");return r.length===n.length&&r.every(((e,t)=>!!bt(n[t])||e===n[t]))}(e,t):function(e,t){const r=e.split("/"),n=t.split("/");return!(r.length<n.length)&&n.every(((e,t)=>!!bt(e)||e===r[t]))}(e,t))),P()).subscribe(c);return()=>n.unsubscribe()}),[]),a};var mt=function({node:e,ctx:r}){var n;Ge(e.lifecycleHooks||{});const o=c(ft),a=(s=o,i=e.path,"/"===s?`/${ht(i)}`:`${s}/${ht(i)}`);var s,i;return yt(r.location$,a,null!=(n=e.exactly)&&n)?t.createElement(ft.Provider,{value:a},t.createElement(jt,{node:e.node,ctx:r})):null};var vt=function({node:e,ctx:r}){const n=Ze(e,r),o=ct(e,r.plugins);return Ge(e.lifecycleHooks||{}),o?e.children&&e.children.length?t.createElement(o,n,t.createElement(gt,{nodes:e.children||[],ctx:r})):t.createElement(o,n):null};function gt({nodes:e,ctx:r}){return e.length?t.createElement(t.Fragment,null,e.map((e=>t.createElement(St,{key:e.id,node:e,ctx:r})))):null}function St({node:e,ctx:r}){const n=`${c(C)}/${e.id}`,o=function(e,t){const r=e.shouldRender,n={id:"placeholder-node",type:"html-element",name:"div",props:r?{shouldRender:r}:void 0},{shouldRender:o}=Ze(n,t);return!r||("api_loading_property"===r.type&&r.revert?!o:!!o)}(e,r);return o?"route-node"===e.type?t.createElement(C.Provider,{value:n},t.createElement(mt,{node:e,ctx:r})):"loop-container"===e.type?t.createElement(C.Provider,{value:n},t.createElement(dt,{node:e,ctx:r})):"html-element"===e.type?t.createElement(C.Provider,{value:n},t.createElement(et,{node:e,ctx:r})):"react-component"===e.type?t.createElement(C.Provider,{value:n},t.createElement(vt,{node:e,ctx:r})):"ref-node"===e.type?t.createElement(C.Provider,{value:n},t.createElement(Ye,{node:e,ctx:r})):"jsx-node"===e.type?t.createElement(C.Provider,{value:n},t.createElement(Qe,{node:e,ctx:r})):(i.error("Unrecognized node type of node:",e),null):null}var jt=St;function xt(e,t){const[r,a]=n();return o((()=>{let r=!1;return Ne({artery:e,plugins:t}).then((e=>{r||a(e)})).catch(i.error),()=>{r=!0}}),[e]),r}e("ArteryRenderer",t.forwardRef((function({artery:e,plugins:r},n){const{ctx:o,rootNode:a}=xt(e,r)||{};return s(n,(()=>{if(o)return{apiStates:o.apiStates,states:o.states,history:o.history}}),[o]),o&&a?t.createElement(jt,{node:a,ctx:o}):null})));class Ot{constructor(e,t){this.artery=e,this.plugins=t||{}}async render(e){const{ctx:r,rootNode:n}=await Ne({plugins:this.plugins,artery:this.artery});A.render(t.createElement(jt,{node:n,ctx:r}),e)}}e("RenderArtery",Ot);e("default",Ot)}}}));
