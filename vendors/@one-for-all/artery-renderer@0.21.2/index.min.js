System.register(["react","@one-for-all/utils","history","rxjs","rxjs/operators","rxjs/ajax","react-dom"],(function(e){"use strict";var t,r,n,o,a,c,s,i,l,u,p,d,f,h,b,y,m,v,g,S,x,j,$,w,O,k,E,P,I,N,_,H,D,A,C;return{setters:[function(e){t=e.default,r=e.useRef,n=e.useState,o=e.useEffect,a=e.useMemo,c=e.useContext,s=e.useImperativeHandle},function(e){i=e.logger},function(e){l=e.createBrowserHistory},function(e){u=e.switchMap,p=e.share,d=e.map,f=e.catchError,h=e.of,b=e.BehaviorSubject,y=e.Subject,m=e.merge,v=e.noop,g=e.from,S=e.firstValueFrom,x=e.combineLatest,j=e.take,$=e.last,w=e.combineLatestWith,O=e.skip,k=e.tap,E=e.distinctUntilKeyChanged,P=e.distinctUntilChanged},function(e){I=e.map,N=e.filter,_=e.share,H=e.skip,D=e.delay},function(e){A=e.ajax},function(e){C=e.default}],execute:function(){e({useBootResult:ht,useNodeComponent:Qe});var L=t.createContext("ROOT"),R=Object.defineProperty,F=Object.defineProperties,V=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,U=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable,z=(e,t,r)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var T=function(e){return new Proxy({},{get:(t,r)=>{const n=e.getState$(r).getValue();return o=((e,t)=>{for(var r in t||(t={}))U.call(t,r)&&z(e,r,t[r]);if(K)for(var r of K(t))W.call(t,r)&&z(e,r,t[r]);return e})({},n),F(o,V({refresh:()=>e.refresh(r),fetch:(t,n)=>{e.fetch(r,{params:t,callback:n})},rawFetch:(t,n)=>{e.rawFetch(r,t)}}));var o}})};function q(e){return"[object Object]"===Object.prototype.toString.call(e)}function B(e,t){if("expression"in e&&"state_convert_expression"===e.type)return function(e,t){try{const r=new Function("state",`return ${e}`).bind(t);return r.toString=()=>["","function wrappedStateConvertor(state) {",`\treturn ${e}`,"}"].join("\n"),r}catch(t){throw new Error(["failed to instantiate state convert expression:","\n",e,"\n",t].join(""))}}(e.expression,t);try{const r=new Function(e.args,e.body).bind(t);return r.toString=()=>["",`function wrappedFunc(${e.args}) {`,`\t${e.body}`,"}",""].join("\n"),r}catch(t){throw new Error(["failed to instantiate function of following spec:","\n","spec.args:",e.args,"\n","spec.body:","\n",e.body,"\n",t].join(""))}}var X=function e(t,r){return q(t)&&"object"==typeof t&&null!==t?(Object.entries(t).forEach((([n,o])=>{!function(e){return!(!q(e)||"object"!=typeof e||null===e)&&("type"in e&&"state_convert_expression"===Reflect.get(e,"type")||3===Object.keys(e).length&&"type"in e&&"args"in e&&"body"in e)}(o)?q(o)?Reflect.set(t,n,e(o,r)):Array.isArray(o)&&Reflect.set(t,n,o.map((t=>e(t,r)))):Reflect.set(t,n,B(o,r))})),t):t};var M=function(e,t){try{return window.structuredClone?X(window.structuredClone(e),t):X(JSON.parse(JSON.stringify(e)),t)}catch(e){return i.error("deserialize failed:",e),null}};function J(e){return A(e).pipe(d((({response:e})=>({result:e,error:void 0}))),f((e=>h({error:e,data:void 0}))))}var Z=Object.defineProperty,G=Object.defineProperties,Q=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable,re=(e,t,r)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ne=(e,t)=>{for(var r in t||(t={}))ee.call(t,r)&&re(e,r,t[r]);if(Y)for(var r of Y(t))te.call(t,r)&&re(e,r,t[r]);return e},oe=(e,t)=>G(e,Q(t));const ae={result:void 0,error:void 0,loading:!1};var ce=function(e,t){const r=new b(ae),n=function(e){return e.pipe(u(J),p())}(e);return n.pipe(I((({result:e,error:t})=>({result:e,error:t,loading:!1}))),I((e=>{if(!t)return e;const r=t({body:e.result,error:e.error});return oe(ne({},r),{loading:e.loading})}))).subscribe(r),e.pipe(N((()=>!1===r.getValue().loading)),I((()=>oe(ne({},r.getValue()),{loading:!0})))).subscribe(r),r},se=Object.getOwnPropertySymbols,ie=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var ue=function(e,t){const r=new y,n=new y,o=n.pipe(I((r=>t.build(e,r))),N(Boolean),_());let a;const c=ce(m(o,r),t.responseAdapter);return c.pipe(H(1),N((({loading:e})=>!e)),D(10)).subscribe((e=>{var t;null==(t=null==a?void 0:a.callback)||t.call(a,e)})),{state$:c,fetch:e=>{a=e,n.next(e.params)},rawFetch:e=>{var t=e,{callback:n}=t,o=((e,t)=>{var r={};for(var n in e)ie.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&se)for(var n of se(e))t.indexOf(n)<0&&le.call(e,n)&&(r[n]=e[n]);return r})(t,["callback"]);a={callback:n},r.next(o)},refresh:()=>{a&&(a={params:a.params},n.next(a.params))}}};const pe={state$:new b(ae),fetch:v,rawFetch:v,refresh:v},de={build:()=>({url:"/api",method:"get"})};class fe{constructor({apiStateSpec:e,apiSpecAdapter:t,parentHub:r}){this.parentHub=void 0,this.parentHub=r,this.cache=Object.entries(e).reduce(((e,[r,{apiID:n}])=>(e[r]=ue(n,t||de),e)),{})}hasState$(e){var t;return!!this.cache[e]||!!(null==(t=this.parentHub)?void 0:t.hasState$(e))}findState$(e){var t;return this.cache[e]?this.cache[e]:null==(t=this.parentHub)?void 0:t.findState$(e)}getState$(e){const{state$:t}=this.findState$(e)||{};return t||(i.error([`can't find api state: ${e}, please check apiStateSpec or parent schema.`,"In order to prevent UI crash, a dummyState$ will be returned."].join(" ")),pe.state$)}fetch(e,t){const{fetch:r}=this.findState$(e)||{};r?r(t):i.error([`can't find api state: ${e}, please check apiStateSpec or parent schema,`,"this fetch action will be ignored."].join(" "))}rawFetch(e,t){const{rawFetch:r}=this.findState$(e)||{};r&&r(t),i.error([`can't find api state: ${e}, please check apiStateSpec or parent schema,`,"this fetch action will be ignored."].join(" "))}refresh(e){const{refresh:t}=this.findState$(e)||{};t?t():i.error([`can't find api state: ${e}, please check apiStateSpec or parent schema,`,"this refresh action will be ignored."].join(" "))}}var he=function(e){return new Proxy({},{get:(t,r)=>e.getState$(r).value,set:(t,r,n)=>r.startsWith("$")?(i.error("node internal state can not be assigned"),!1):(e.mutateState(r,n),!0)})};class be{constructor(e,t){this.parentHub=void 0,this.unWriteableStates=[],this.parentHub=t,this.cache=Object.entries(e).reduce(((e,[t,{initial:r,writeable:n}])=>(e[t]=new b(r),!1===n&&this.unWriteableStates.push(t),e)),{})}hasState$(e){var t;return!!this.cache[e]||!!(null==(t=this.parentHub)?void 0:t.hasState$(e))}_createState$(e,t){this.cache[e]=new b(t)}findState$(e){var t;return this.cache[e]?this.cache[e]:null==(t=this.parentHub)?void 0:t.findState$(e)}getState$(e){const t=this.findState$(e);return t||(this._createState$(e),this.cache[e])}mutateState(e,t){e.startsWith("$")?i.warn("shared stateID can not starts with $, this action will be ignored"):this.unWriteableStates.includes(e)?i.warn("this shared state is not allowed to be written, this action will be ignored"):this.getState$(e).next(t)}getNodeState$(e){const t=`$${e}`;return this.getState$(t)}exposeNodeState(e,t){const r=`$${e}`;this.cache[r]?this.cache[r].next(t):this._createState$(r,t)}}var ye=Object.defineProperty,me=Object.defineProperties,ve=Object.getOwnPropertyDescriptors,ge=Object.getOwnPropertySymbols,Se=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable,je=(e,t,r)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;function $e(e,t,r){const{state$:n,fetch:o}=ue(t,e),a=n.pipe(j(2),$(),d((({result:e})=>e)));return o({params:r}),a}function we(e,t,r){return e.map((({stateID:e,func:n,dependencies:o})=>{const a=function(e,t,r){const n=Object.entries(e).map((([e,n])=>{if(!t[e])return void i.error(`no state: ${e} found in APIStatesSpec, undefined will be used as this dependency value`);const{apiID:o}=t[e];return[e,$e(r,o,n)]})).filter((e=>!!e)).reduce(((e,[t,r])=>(e[t]=r,e)),{});return Object.keys(n).length?x(n):h({})}(o||{},t,r),c=a.pipe(u((e=>g(function(e){return t=>Promise.resolve((()=>{try{return e(t)}catch(e){return}})())}(n)(e)))));return[e,c]})).reduce(((e,[t,r])=>(e[t]=r,e)),{})}function Oe(e){return Object.entries(e).map((([e,{initializer:t}])=>{if(t)return r=((e,t)=>{for(var r in t||(t={}))Se.call(t,r)&&je(e,r,t[r]);if(ge)for(var r of ge(t))xe.call(t,r)&&je(e,r,t[r]);return e})({},t),me(r,ve({stateID:e}));var r})).filter((e=>!!e))}var ke=async function(e,t,r){if(!r)return e;const n=we(Oe(e),t,r);if(!Object.keys(n).length)return e;const o=await S(x(n));return Object.entries(o).forEach((([t,r])=>{e[t].initial=r})),e};function Ee(e,t){var r;const n=e.props||{};return Object.values(n).forEach((e=>{"inherited_property"===e.type&&e.parentID&&t.add(e.parentID)})),"children"in e&&(null==(r=e.children)||r.forEach((e=>Ee(e,t)))),"node"in e&&Ee(e.node,t),t}const Pe=["dummyLoopContainer","placeholder-node"];var Ie=class{constructor(e){this.cache={},this.cacheIDs=e}shouldCache(e){return this.cacheIDs.has(e)}initState(e){this.cache[e]||(this.cache[e]=new b({}))}getProps$(e){return this.initState(e),this.cache[e]}setProps(e,t,r){const n=function(e){return e.replace(/\/(.+)\/[0-9]+/g,"/$1").split("/").pop()}(e);n&&!Pe.includes(t)&&this.shouldCache(n)&&(this.cache[n]?this.cache[n].next(r):this.cache[n]=new b(r))}};async function Ne({artery:e,parentCTX:t,plugins:r}){const{apiStateSpec:n,sharedStatesSpec:o}=e,a=Object.assign({},(null==t?void 0:t.plugins)||{},r||{}),c=new fe({apiSpecAdapter:a.apiSpecAdapter,apiStateSpec:n||{},parentHub:null==t?void 0:t.statesHubAPI}),s=M(o||{},void 0),i=await ke(s||{},n||{},a.apiSpecAdapter),u=new be(i,null==t?void 0:t.statesHubShared),p=(null==t?void 0:t.history)||l(),d=(null==t?void 0:t.location$)||new b(p.location);(null==t?void 0:t.location$)||p.listen((({location:e})=>{d.next(e)}));const f=Ee(e.node,new Set),h=new Ie(f);return{statesHubAPI:c,statesHubShared:u,apiStates:T(c),states:he(u),history:p,location$:d,nodePropsCache:h,plugins:a}}var _e=e("bootUp",(async function({artery:e,parentCTX:t,plugins:r}){const n=await Ne({artery:e,parentCTX:t,plugins:r}),o=function(e,t){const r=M(e,{apiStates:t.apiStates,states:t.states,history:t.history});if(!r)throw new Error("failed to init ctx!");return r}(e.node,n);return{ctx:n,rootNode:o}}));function He({state:e,convertor:t,fallback:r,propName:n}){var o;if(t&&void 0!==e)try{return null!=(o=t(e))?o:r}catch(o){return i.error(`an error occurred while calling state convertor for prop: "${n}"`,"with the following state and convertor:","\n",e,"\n",t.toString(),"\n","So return fallback instead, fallback:",r,"\n","\n",o),r}return null!=e?e:r}var De=function(e,t){const a={},c={},s={};Object.entries(e.props||{}).filter((e=>"api_result_property"===e[1].type)).forEach((([e,{fallback:r,convertor:n,stateID:o}])=>{s[e]=r,a[e]=n,c[e]=t.statesHubAPI.getState$(o)}));const i=r(s),[l,u]=n((()=>Object.entries(c).reduce(((e,[t,r])=>(e[t]=He({state:r.getValue().result,convertor:a[t],fallback:i.current[t],propName:t}),e)),{})));return o((()=>{const e=Object.entries(c).reduce(((e,[t,r])=>(e[t]=r.pipe(E("result"),d((({result:e})=>He({state:e,convertor:a[t],fallback:i.current[t],propName:t}))),k((e=>{i.current[t]=e}))),e)),{}),t=x(e).pipe(O(1)).subscribe(u);return()=>t.unsubscribe()}),[]),l};var Ae=function(e,t){const r={};Object.entries(e.props||{}).filter((e=>"api_loading_property"===e[1].type)).forEach((([e,{stateID:n}])=>{r[e]=t.statesHubAPI.getState$(n)}));const[a,c]=n((()=>Object.entries(r).reduce(((e,[t,r])=>(e[t]=r.getValue().loading,e)),{})));return o((()=>{const e=Object.entries(r).reduce(((e,[t,r])=>(e[t]=r.pipe(O(1),E("loading"),d((({loading:e})=>e))),e)),{}),t=x(e).subscribe(c);return()=>t.unsubscribe()}),[]),a};var Ce=function(e,t){const a={},c={},s={};Object.entries(e.props||{}).filter((e=>"shared_state_property"===e[1].type||"node_state_property"===e[1].type)).forEach((([e,r])=>{"shared_state_property"===r.type?(c[e]=t.statesHubShared.getState$(r.stateID),a[e]=r.convertor):(c[e]=t.statesHubShared.getNodeState$(r.nodePath),a[e]=r.convertor),s[e]=r.fallback}));const i=r(s),[l,u]=n((()=>Object.entries(c).reduce(((e,[t,r])=>(e[t]=He({state:r.getValue(),convertor:a[t],fallback:i.current[t],propName:t}),e)),{})));return o((()=>{if(!Object.keys(c).length)return;const e=Object.entries(c).reduce(((e,[t,r])=>(e[t]=r.pipe(P(),d((e=>He({state:e,convertor:a[t],fallback:i.current[t],propName:t}))),k((e=>{i.current[t]=e}))),e)),{}),t=x(e).pipe(O(1)).subscribe(u);return()=>t.unsubscribe()}),[]),l};var Le=function(e,t){return a((()=>e.props?Object.entries(e.props).filter((e=>"shared_state_mutation_property"===e[1].type)).reduce(((e,[r,{stateID:n,convertor:o}])=>(e[r]=function(e){if("function"==typeof o)try{const r=o(e);t.statesHubShared.mutateState(n,r)}catch(e){i.error("failed to run convertor:\n",o.toString(),"\n",e)}else t.statesHubShared.mutateState(n,e)},e)),{}):{}),[])};var Re=function(e,t){const r=c(L);return a((()=>"supportStateExposure"in e&&e.supportStateExposure?{__exposeState:n=>{t.statesHubShared.exposeNodeState(`${r}/${e.id}`,n)}}:{}),[])};var Fe=function({props:e},r){return a((()=>Object.entries(e||{}).filter((e=>"render_property"===e[1].type)).reduce(((e,[n,{adapter:o,node:a}])=>(e[n]=function(e,r,n){return(...o)=>{let a={};try{const e=(null==n?void 0:n(...o))||{};"object"==typeof e?a=Object.entries(e).reduce(((e,[t,r])=>(e[t]={type:"constant_property",value:r},e)),{}):i.error("toProps result is no Object")}catch(e){i.error("failed to call toProps",e)}return e.props=Object.assign({},e.props,a),t.createElement(ft,{node:e,ctx:r})}}(a,r,o),e)),{})),[])};function Ve(e,t){const r={};Object.entries(e.props||{}).filter((e=>"computed_property"===e[1].type)).forEach((([e,{deps:n,convertor:o,fallback:a}])=>{r[e]=function({propName:e,deps:t,convertor:r,ctx:n,fallback:o}){let a=o;const c=t.map((({type:e,depID:t})=>"api_state"===e?n.statesHubAPI.getState$(t):"node_state"===e?n.statesHubShared.getNodeState$(t):n.statesHubShared.getState$(t))),s=c.reduce(((e,r,n)=>(e[t[n].depID]=r.value,e)),{}),i=new b(He({state:s,convertor:r,fallback:o,propName:e}));return h(!0).pipe(w(c),d(((t,...n)=>He({state:n,convertor:r,fallback:a,propName:e}))),O(1),k((e=>{a=e}))).subscribe((e=>i.next(e))),i}({propName:e,deps:n,convertor:o,ctx:t,fallback:a})}));const[a,c]=n((()=>Object.entries(r).reduce(((e,[t,r])=>(e[t]=r.value,e)),{})));return o((()=>{const e=x(r).pipe(O(1)).subscribe(c);return()=>e.unsubscribe()}),[]),a}var Ke=function(e,t){const a={},c={},s={};Object.entries(e.props||{}).filter((e=>"inherited_property"===e[1].type)).forEach((([e,{fallback:r,convertor:n,parentID:o}])=>{var i;s[e]=r,a[e]=n,c[e]=null==(i=t.nodePropsCache)?void 0:i.getProps$(o)}));const i=r(s),[l,u]=n((()=>Object.entries(c).reduce(((e,[t,r])=>r?(e[t]=He({state:null==r?void 0:r.getValue(),convertor:a[t],fallback:i.current[t],propName:t}),e):(e[t]=i.current[t],e)),{})));return o((()=>{const e=Object.entries(c).reduce(((e,[t,r])=>r?(e[t]=r.pipe(d((e=>He({state:e,convertor:a[t],fallback:i.current[t],propName:t}))),k((e=>i.current[t]=e))),e):(e[t]=h(i.current[t]),e)),{}),t=x(e).pipe(O(1)).subscribe(u);return()=>t.unsubscribe()}),[]),l};var Ue=function(e,t){return"isLink"in e&&e.isLink&&"html-element"===e.type&&"a"===e.name?{onClick:e=>{e.stopPropagation(),e.preventDefault();const r=e.currentTarget.href;r&&t.history.push(r)}}:{}};var We=e("useInstantiateProps",(function(e,t){const r=c(L),n=function(e){return e.props?Object.entries(e.props).filter((e=>"constant_property"===e[1].type)).reduce(((e,[t,{value:r}])=>(e[t]=r,e)),{}):{}}(e),o=De(e,t),s=Ae(e,t),l=Ce(e,t),u=Re(e,t),p=Ve(e,t),d=Ke(e,t),f=function(e){return a((()=>e.props?Object.entries(e.props).filter((e=>"functional_property"===e[1].type)).reduce(((t,[r,{func:n}])=>(t[r]=(...t)=>{try{n(...t)}catch(o){i.error(`an error occurred while run node '${e.id}' functional property:`,r,"with the following arguments:","\n",t,"\n","function is:","\n",n.toString(),"\n",o)}},t)),{}):{}),[])}(e),h=Le(e,t),b=function(e,t){return a((()=>e.props?Object.entries(e.props).filter((e=>"api_invoke_property"===e[1].type)).reduce(((e,[r,{stateID:n,paramsBuilder:o,callback:a}])=>(i.warn("hook useAPIInvokeProps has been deprecated, please use hook useFuncProps instead"),e[r]=function(...e){try{const r=(null==o?void 0:o(...e))||{};t.apiStates[n].fetch(r,a)}catch(e){i.log("failed to run convertor or run action:",e)}},e)),{}):{}),[])}(e,t),y=Fe(e,t),m=Ue(e,t);return a((()=>{var a;const c=Object.assign(n,b,o,s,l,p,h,u,y,m,d);return null==(a=t.nodePropsCache)||a.setProps(r,e.id,c),Object.assign(c,f)}),[o,l,s,p,n])}));function ze({didMount:e,willUnmount:t}){o((()=>(null==e||e(),()=>{null==t||t()})),[])}var Te=function({node:e,ctx:r}){const a=We(e,r);ze(e.lifecycleHooks||{});const s=c(L),l=function(){const[e,t]=n(null);return o((()=>{let e=!1;return System.import("react-jsx-parser").then((r=>{e||t((()=>r.default))})).catch((e=>{i.error("failed to load dependance react-jsx-parser:",e)})),()=>{e=!0}})),e}();return e.jsx?l?t.createElement(l,{bindings:a,renderInWrapper:!1,jsx:e.jsx,onError:e=>console.log(e)}):null:(i.error("jsx string is required,",`please check the spec of node: ${s}.`),null)};function qe({node:e,ctx:r}){ze(e.lifecycleHooks||{});const a=function({arteryID:e,refLoader:t,orphan:r},a){const[s,l]=n(),u=c(L);return o((()=>{if(!e)return void i.error(`arteryID is required on RefNode, please check the spec for node: ${u}`);if(!t)return void i.error("refLoader is required on RefNode in order to get ref schema and corresponding APISpecAdapter,","please implement refLoader and pass it to parent RenderEngine.",`current RefNode path is: ${u}`);let n,o=!1;return t(e).then((({artery:e,plugins:t})=>{if(!o)return n=e,_e({plugins:t,artery:e,parentCTX:r?void 0:a})})).then((e=>{e&&n&&l({ctx:e.ctx,rootNode:e.rootNode})})).catch(i.error),()=>{o=!0}}),[]),s}({arteryID:e.arteryID,refLoader:r.plugins.refLoader,orphan:e.orphan},r);return a?t.createElement(ft,{node:a.rootNode,ctx:a.ctx}):e.fallback?t.createElement(ft,{node:e.fallback,ctx:r}):null}var Be=function({node:e,ctx:r}){const n=We(e,r);ze(e.lifecycleHooks||{});const o=c(L);return e.name?e.children&&e.children.length?t.createElement(e.name,n,t.createElement(pt,{nodes:e.children||[],ctx:r})):t.createElement(e.name,n):(i.error("name property is required in html node spec,",`please check the spec of node: ${o}.`),null)};function Xe(e,t){const r=c(L),n={type:"html-element",id:"dummyLoopContainer",name:"div",props:{iterable:e}},{iterable:o}=We(n,t);if(!Array.isArray(o)){const t=r.split("/").pop();return i.error("state is not iterable.",`LoopContainer node [${t}] require a array type state,`,`but got: ${o},`,"please check the follow property spec:\n",e),null}return o}function Me(e,t,r){return"string"==typeof e||"number"==typeof e?e:void 0===e||"function"==typeof e||"boolean"==typeof e?r:"object"==typeof e&&null!==e?Reflect.get(e,t):r}function Je(e,t,r,n){try{const o=r(e,t);return"object"==typeof o||o?o:(i.error("toProps result should be an object, but got: ${toPropsResult},",`please check the toProps spec of node: ${n},`,"the corresponding node will be skipped for render."),null)}catch(t){return i.error("An error occurred while calling toProps with the following parameter:",e,"\n","error:",t,"\n",`please check the toProps spec of node: ${n},`,"the corresponding node will be skipped for render."),null}}var Ze=function({iterableState:e,loopKey:r,node:n,ctx:o,toProps:a}){const s=c(L),i=function({iterableState:e,toProps:t,otherProps:r,ctx:n,loopKey:o}){const a=Xe(e,n),s=c(L);return a?a.map(((e,n)=>{const a=Je(e,n,t,s);if(!a)return null;const c=Object.entries(a).reduce(((e,[t,r])=>(e[t]={type:"constant_property",value:r},e)),{});return[Me(e,o,n),Object.assign({},r,c)]})).filter((e=>!!e)):null}({iterableState:e,toProps:a,ctx:o,loopKey:r,otherProps:n.props});return i?t.createElement(t.Fragment,null,i.map((([e,r],a)=>{const c=Object.assign({},n,{props:r});return t.createElement(L.Provider,{value:`${s}/${a}`,key:e},t.createElement(ft,{key:e,node:c,ctx:o}))}))):null};function Ge({packageName:e,exportName:t}){return System.import(e).then((e=>e[t||"default"])).catch((e=>(i.error("failed to load node component,",e),null)))}function Qe(e,{repository:t,componentLoader:r}){const a=c(L),[s,l]=n((()=>{if(t)return function(e,{packageName:t,packageVersion:r,exportName:n}){var o;return null==(o=e[`${t}@${r}`])?void 0:o[n||"default"]}(t,e)}));return o((()=>{if(s)return;let t=!1;return(r||Ge)({packageName:e.packageName,packageVersion:e.packageVersion,exportName:e.exportName}).then((r=>{t||(r?l((()=>r)):i.error(`got empty component for package: ${e.packageName},`,`exportName: ${e.exportName}, version: ${e.packageVersion}`,`please check the spec for node: ${a}.`))})).catch(i.error),()=>{t=!0}}),[s]),s}function Ye({outLayer:e,ctx:r,children:n}){const o=We(e,r);return t.createElement(e.name,o,n)}function et({outLayer:e,ctx:r,children:n}){const o=We(e,r),a=Qe(e,r.plugins);return ze(e.lifecycleHooks||{}),a?t.createElement(a,o,n):null}function tt({outLayer:e,ctx:r,children:n}){return"html-element"===(null==e?void 0:e.type)?t.createElement(Ye,{outLayer:e,ctx:r},n):"react-component"===(null==e?void 0:e.type)?t.createElement(et,{outLayer:e,ctx:r},n):t.createElement(t.Fragment,null,n)}function rt({node:e,composedState:r,ctx:n,index:o}){const s=function(e,t,r,n){const o=c(L);return a((()=>{const a=Je(e,r,t,o),c=Object.entries(a||{}).reduce(((e,[t,r])=>(e[t]={type:"constant_property",value:r},e)),{});return Object.assign({},n,c)}),[e,n])}(r,e.toProps,o,e.props),i=Object.assign({},e,{props:s});return t.createElement(ft,{node:i,ctx:n})}var nt=function({iterableState:e,loopKey:r,node:n,ctx:o}){const a=c(L),s=Xe(e,o);return s?t.createElement(t.Fragment,null,s.map(((e,c)=>{const s=Me(e,r,c);return t.createElement(L.Provider,{value:`${a}/${n.id}/${c}`,key:c},t.createElement(tt,{key:s,outLayer:n.outLayer,ctx:o},(n.nodes||n.children).map(((r,n)=>t.createElement(rt,{node:r,composedState:e,ctx:o,index:n,key:r.id})))))}))):null};var ot=function({node:e,ctx:r}){ze(e.lifecycleHooks||{});const{node:n}=e;return"composed-node"!==n.type&&"toProps"in e?t.createElement(Ze,{iterableState:e.iterableState,loopKey:e.loopKey,node:n,toProps:t=>e.toProps(t),ctx:r}):"composed-node"===n.type?t.createElement(nt,{iterableState:e.iterableState,loopKey:e.loopKey,node:n,ctx:r}):(i.error("Unrecognized loop node:",e),null)};var at=t.createContext("/");function ct(e){return e.replace(/^\/|\/$/g,"")}function st(e){return/^:[a-zA-Z_][[a-zA-Z_$0-9]+$/.test(e)}var it=function(e,t,r){const[a,c]=n(!1);return o((()=>{const n=e.pipe(d((({pathname:e})=>r?function(e,t){const r=e.split("/"),n=t.split("/");return r.length===n.length&&r.every(((e,t)=>!!st(n[t])||e===n[t]))}(e,t):function(e,t){const r=e.split("/"),n=t.split("/");return!(r.length<n.length)&&n.every(((e,t)=>!!st(e)||e===r[t]))}(e,t))),P()).subscribe(c);return()=>n.unsubscribe()}),[]),a};var lt=function({node:e,ctx:r}){var n;ze(e.lifecycleHooks||{});const o=c(at),a=(s=o,i=e.path,"/"===s?`/${ct(i)}`:`${s}/${ct(i)}`);var s,i;return it(r.location$,a,null!=(n=e.exactly)&&n)?t.createElement(at.Provider,{value:a},t.createElement(ft,{node:e.node,ctx:r})):null};var ut=function({node:e,ctx:r}){const n=We(e,r),o=Qe(e,r.plugins);return ze(e.lifecycleHooks||{}),o?e.children&&e.children.length?t.createElement(o,n,t.createElement(pt,{nodes:e.children||[],ctx:r})):t.createElement(o,n):null};function pt({nodes:e,ctx:r}){return e.length?t.createElement(t.Fragment,null,e.map((e=>t.createElement(dt,{key:e.id,node:e,ctx:r})))):null}function dt({node:e,ctx:r}){const n=`${c(L)}/${e.id}`,o=function(e,t){const r=e.shouldRender,n={id:"placeholder-node",type:"html-element",name:"div",props:r?{shouldRender:r}:void 0},{shouldRender:o}=We(n,t);return!r||("api_loading_property"===r.type&&r.revert?!o:!!o)}(e,r);return o?"route-node"===e.type?t.createElement(L.Provider,{value:n},t.createElement(lt,{node:e,ctx:r})):"loop-container"===e.type?t.createElement(L.Provider,{value:n},t.createElement(ot,{node:e,ctx:r})):"html-element"===e.type?t.createElement(L.Provider,{value:n},t.createElement(Be,{node:e,ctx:r})):"react-component"===e.type?t.createElement(L.Provider,{value:n},t.createElement(ut,{node:e,ctx:r})):"ref-node"===e.type?t.createElement(L.Provider,{value:n},t.createElement(qe,{node:e,ctx:r})):"jsx-node"===e.type?t.createElement(L.Provider,{value:n},t.createElement(Te,{node:e,ctx:r})):(i.error("Unrecognized node type of node:",e),null):null}var ft=dt;function ht(e,t){const[r,a]=n();return o((()=>{let r=!1;return _e({artery:e,plugins:t}).then((e=>{r||a(e)})).catch(i.error),()=>{r=!0}}),[e]),r}e("ArteryRenderer",t.forwardRef((function({artery:e,plugins:r},n){const{ctx:o,rootNode:a}=ht(e,r)||{};return s(n,(()=>{if(o)return{apiStates:o.apiStates,states:o.states,history:o.history}}),[o]),o&&a?t.createElement(ft,{node:a,ctx:o}):null})));class bt{constructor(e,t){this.artery=e,this.plugins=t||{}}async render(e){const{ctx:r,rootNode:n}=await _e({plugins:this.plugins,artery:this.artery});C.render(t.createElement(ft,{node:n,ctx:r}),e)}}e("RenderArtery",bt);e("default",bt)}}}));
