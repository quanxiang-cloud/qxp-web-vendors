System.register(["react","@one-for-all/utils","history","rxjs","rxjs/operators","rxjs/ajax","react-dom"],(function(e){"use strict";var t,r,n,o,a,c,s,i,l,p,u,d,f,h,b,m,y,g,v,S,j,x,$,O,w,k,E,P,_,N,I,H,D,A,L;return{setters:[function(e){t=e.default,r=e.useRef,n=e.useState,o=e.useEffect,a=e.useMemo,c=e.useContext,s=e.useImperativeHandle},function(e){i=e.logger},function(e){l=e.createBrowserHistory},function(e){p=e.switchMap,u=e.share,d=e.map,f=e.catchError,h=e.of,b=e.BehaviorSubject,m=e.Subject,y=e.merge,g=e.noop,v=e.from,S=e.firstValueFrom,j=e.combineLatest,x=e.take,$=e.last,O=e.combineLatestWith,w=e.skip,k=e.tap,E=e.distinctUntilKeyChanged,P=e.distinctUntilChanged},function(e){_=e.map,N=e.filter,I=e.share,H=e.skip,D=e.delay},function(e){A=e.ajax},function(e){L=e.default}],execute:function(){const R=t.createContext("ROOT");var C=Object.defineProperty,F=Object.defineProperties,V=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable,U=(e,t,r)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;function q(e){return new Proxy({},{get:(t,r)=>{const n=e.getState$(r).getValue();return o=((e,t)=>{for(var r in t||(t={}))W.call(t,r)&&U(e,r,t[r]);if(K)for(var r of K(t))z.call(t,r)&&U(e,r,t[r]);return e})({},n),F(o,V({refresh:()=>e.refresh(r),fetch:(t,n)=>{e.fetch(r,{params:t,callback:n})},rawFetch:(t,n)=>{e.rawFetch(r,t)}}));var o}})}function B(e){return"[object Object]"===Object.prototype.toString.call(e)}function T(e,t){if("expression"in e&&"state_convert_expression"===e.type)return function(e,t){try{const r=new Function("state",`return ${e}`).bind(t);return r.toString=()=>["","function wrappedStateConvertor(state) {",`\treturn ${e}`,"}"].join("\n"),r}catch(t){throw new Error(["failed to instantiate state convert expression:","\n",e,"\n",t].join(""))}}(e.expression,t);try{const r=new Function(e.args,e.body).bind(t);return r.toString=()=>["",`function wrappedFunc(${e.args}) {`,`\t${e.body}`,"}",""].join("\n"),r}catch(t){throw new Error(["failed to instantiate function of following spec:","\n","spec.args:",e.args,"\n","spec.body:","\n",e.body,"\n",t].join(""))}}function M(e,t){return B(e)&&"object"==typeof e&&null!==e?(Object.entries(e).forEach((([r,n])=>{!function(e){return!(!B(e)||"object"!=typeof e||null===e)&&("type"in e&&"state_convert_expression"===Reflect.get(e,"type")||3===Object.keys(e).length&&"type"in e&&"args"in e&&"body"in e)}(n)?B(n)?Reflect.set(e,r,M(n,t)):Array.isArray(n)&&Reflect.set(e,r,n.map((e=>M(e,t)))):Reflect.set(e,r,T(n,t))})),e):e}function J(e,t){try{return M(JSON.parse(JSON.stringify(e)),t)}catch(e){return i.error("deserialize failed:",e),null}}function X(e){return A(e).pipe(d((({response:e})=>({result:e,error:void 0}))),f((e=>h({error:e,data:void 0}))))}var Z=Object.defineProperty,G=Object.defineProperties,Q=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable,re=(e,t,r)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ne=(e,t)=>{for(var r in t||(t={}))ee.call(t,r)&&re(e,r,t[r]);if(Y)for(var r of Y(t))te.call(t,r)&&re(e,r,t[r]);return e},oe=(e,t)=>G(e,Q(t));const ae={result:void 0,error:void 0,loading:!1};function ce(e,t){const r=new b(ae),n=function(e){return e.pipe(p(X),u())}(e);return n.pipe(_((({result:e,error:t})=>({result:e,error:t,loading:!1}))),_((e=>{if(!t)return e;const r=t({body:e.result,error:e.error});return oe(ne({},r),{loading:e.loading})}))).subscribe(r),e.pipe(N((()=>!1===r.getValue().loading)),_((()=>oe(ne({},r.getValue()),{loading:!0})))).subscribe(r),r}var se=Object.getOwnPropertySymbols,ie=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;function pe(e,t){const r=new m,n=new m,o=n.pipe(_((r=>t.build(e,r))),N(Boolean),I());let a;const c=ce(y(o,r),t.responseAdapter);return c.pipe(H(1),N((({loading:e})=>!e)),D(10)).subscribe((e=>{var t;null==(t=null==a?void 0:a.callback)||t.call(a,e)})),{state$:c,fetch:e=>{a=e,n.next(e.params)},rawFetch:e=>{var t=e,{callback:n}=t,o=((e,t)=>{var r={};for(var n in e)ie.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&se)for(var n of se(e))t.indexOf(n)<0&&le.call(e,n)&&(r[n]=e[n]);return r})(t,["callback"]);a={callback:n},r.next(o)},refresh:()=>{a&&(a={params:a.params},n.next(a.params))}}}const ue={state$:new b(ae),fetch:g,rawFetch:g,refresh:g},de={build:()=>({url:"/api",method:"get"})};class fe{constructor({apiStateSpec:e,apiSpecAdapter:t,parentHub:r}){this.parentHub=void 0,this.parentHub=r,this.cache=Object.entries(e).reduce(((e,[r,{apiID:n}])=>(e[r]=pe(n,t||de),e)),{})}hasState$(e){var t;return!!this.cache[e]||!!(null==(t=this.parentHub)?void 0:t.hasState$(e))}findState$(e){var t;return this.cache[e]?this.cache[e]:null==(t=this.parentHub)?void 0:t.findState$(e)}getState$(e){const{state$:t}=this.findState$(e)||{};return t||(i.error([`can't find api state: ${e}, please check apiStateSpec or parent schema.`,"In order to prevent UI crash, a dummyState$ will be returned."].join(" ")),ue.state$)}fetch(e,t){const{fetch:r}=this.findState$(e)||{};r?r(t):i.error([`can't find api state: ${e}, please check apiStateSpec or parent schema,`,"this fetch action will be ignored."].join(" "))}rawFetch(e,t){const{rawFetch:r}=this.findState$(e)||{};r&&r(t),i.error([`can't find api state: ${e}, please check apiStateSpec or parent schema,`,"this fetch action will be ignored."].join(" "))}refresh(e){const{refresh:t}=this.findState$(e)||{};t?t():i.error([`can't find api state: ${e}, please check apiStateSpec or parent schema,`,"this refresh action will be ignored."].join(" "))}}function he(e){return new Proxy({},{get:(t,r)=>e.getState$(r).value,set:(t,r,n)=>r.startsWith("$")?(i.error("node internal state can not be assigned"),!1):(e.mutateState(r,n),!0)})}class be{constructor(e,t){this.parentHub=void 0,this.unWriteableStates=[],this.parentHub=t,this.cache=Object.entries(e).reduce(((e,[t,{initial:r,writeable:n}])=>(e[t]=new b(r),!1===n&&this.unWriteableStates.push(t),e)),{})}hasState$(e){var t;return!!this.cache[e]||!!(null==(t=this.parentHub)?void 0:t.hasState$(e))}_createState$(e,t){this.cache[e]=new b(t)}findState$(e){var t;return this.cache[e]?this.cache[e]:null==(t=this.parentHub)?void 0:t.findState$(e)}getState$(e){const t=this.findState$(e);return t||(this._createState$(e),this.cache[e])}mutateState(e,t){e.startsWith("$")?i.warn("shared stateID can not starts with $, this action will be ignored"):this.unWriteableStates.includes(e)?i.warn("this shared state is not allowed to be written, this action will be ignored"):this.getState$(e).next(t)}getNodeState$(e){const t=`$${e}`;return this.getState$(t)}exposeNodeState(e,t){const r=`$${e}`;this.cache[r]?this.cache[r].next(t):this._createState$(r,t)}}var me=Object.defineProperty,ye=Object.defineProperties,ge=Object.getOwnPropertyDescriptors,ve=Object.getOwnPropertySymbols,Se=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable,xe=(e,t,r)=>t in e?me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;function $e(e,t,r){const{state$:n,fetch:o}=pe(t,e),a=n.pipe(x(2),$(),d((({result:e})=>e)));return o({params:r}),a}function Oe(e,t,r){return e.map((({stateID:e,func:n,dependencies:o})=>{const a=function(e,t,r){const n=Object.entries(e).map((([e,n])=>{if(!t[e])return void i.error(`no state: ${e} found in APIStatesSpec, undefined will be used as this dependency value`);const{apiID:o}=t[e];return[e,$e(r,o,n)]})).filter((e=>!!e)).reduce(((e,[t,r])=>(e[t]=r,e)),{});return Object.keys(n).length?j(n):h({})}(o||{},t,r),c=a.pipe(p((e=>v(function(e){return t=>Promise.resolve((()=>{try{return e(t)}catch(e){return}})())}(n)(e)))));return[e,c]})).reduce(((e,[t,r])=>(e[t]=r,e)),{})}function we(e){return Object.entries(e).map((([e,{initializer:t}])=>{if(t)return r=((e,t)=>{for(var r in t||(t={}))Se.call(t,r)&&xe(e,r,t[r]);if(ve)for(var r of ve(t))je.call(t,r)&&xe(e,r,t[r]);return e})({},t),ye(r,ge({stateID:e}));var r})).filter((e=>!!e))}function ke(e,t){var r;const n=e.props||{};return Object.values(n).forEach((e=>{"inherited_property"===e.type&&e.parentID&&t.add(e.parentID)})),"children"in e&&(null==(r=e.children)||r.forEach((e=>ke(e,t)))),"node"in e&&ke(e.node,t),t}const Ee=["dummyLoopContainer","placeholder-node"];class Pe{constructor(e){this.cache={},this.cacheIDs=e}shouldCache(e){return this.cacheIDs.has(e)}initState(e){this.cache[e]||(this.cache[e]=new b({}))}getProps$(e){return this.initState(e),this.cache[e]}setProps(e,t,r){const n=function(e){return e.replace(/\/(.+)\/[0-9]+/g,"/$1").split("/").pop()}(e);n&&!Ee.includes(t)&&this.shouldCache(n)&&(this.cache[n]?this.cache[n].next(r):this.cache[n]=new b(r))}}async function _e({schema:e,parentCTX:t,plugins:r}){const{apiStateSpec:n,sharedStatesSpec:o}=e,a=Object.assign({},(null==t?void 0:t.plugins)||{},r||{}),c=new fe({apiSpecAdapter:a.apiSpecAdapter,apiStateSpec:n||{},parentHub:null==t?void 0:t.statesHubAPI}),s=J(o||{},void 0),i=await async function(e,t,r){if(!r)return e;const n=Oe(we(e),t,r);if(!Object.keys(n).length)return e;const o=await S(j(n));return Object.entries(o).forEach((([t,r])=>{e[t].initial=r})),e}(s||{},n||{},a.apiSpecAdapter),p=new be(i,null==t?void 0:t.statesHubShared),u=(null==t?void 0:t.history)||l(),d=(null==t?void 0:t.location$)||new b(u.location);(null==t?void 0:t.location$)||u.listen((({location:e})=>{d.next(e)}));const f=ke(e.node,new Set),h=new Pe(f),m={statesHubAPI:c,statesHubShared:p,apiStates:q(c),states:he(p),history:u,location$:d,nodePropsCache:h,plugins:a},y=J(e.node,{apiStates:m.apiStates,states:m.states,history:m.history});return y?{ctx:m,rootNode:y}:Promise.reject(new Error("failed to init ctx!"))}function Ne({state:e,convertor:t,fallback:r,propName:n}){var o;if(t&&void 0!==e)try{return null!=(o=t(e))?o:r}catch(o){return i.error(`an error occurred while calling state convertor for prop: "${n}"`,"with the following state and convertor:","\n",e,"\n",t.toString(),"\n","So return fallback instead, fallback:",r,"\n","\n",o),r}return null!=e?e:r}function Ie({props:e},r){return a((()=>Object.entries(e||{}).filter((e=>"render_property"===e[1].type)).reduce(((e,[n,{adapter:o,node:a}])=>(e[n]=function(e,r,n){return(...o)=>{let a={};try{const e=(null==n?void 0:n(...o))||{};"object"==typeof e?a=Object.entries(e).reduce(((e,[t,r])=>(e[t]={type:"constant_property",value:r},e)),{}):i.error("toProps result is no Object")}catch(e){i.error("failed to call toProps",e)}return e.props=Object.assign({},e.props,a),t.createElement(nt,{node:e,ctx:r})}}(a,r,o),e)),{})),[])}function He(e,t){const r={};Object.entries(e.props||{}).filter((e=>"computed_property"===e[1].type)).forEach((([e,{deps:n,convertor:o,fallback:a}])=>{r[e]=function({propName:e,deps:t,convertor:r,ctx:n,fallback:o}){let a=o;const c=t.map((({type:e,depID:t})=>"api_state"===e?n.statesHubAPI.getState$(t):"node_state"===e?n.statesHubShared.getNodeState$(t):n.statesHubShared.getState$(t))),s=c.map((e=>e.value)),i=new b(Ne({state:s,convertor:r,fallback:o,propName:e}));return h(!0).pipe(O(c),d(((t,...n)=>Ne({state:n,convertor:r,fallback:a,propName:e}))),w(1),k((e=>{a=e}))).subscribe((e=>i.next(e))),i}({propName:e,deps:n,convertor:o,ctx:t,fallback:a})}));const[a,c]=n((()=>Object.entries(r).reduce(((e,[t,r])=>(e[t]=r.value,e)),{})));return o((()=>{const e=j(r).pipe(w(1)).subscribe(c);return()=>e.unsubscribe()}),[]),a}function De(e,t){const s=c(R),l=function(e){return e.props?Object.entries(e.props).filter((e=>"constant_property"===e[1].type)).reduce(((e,[t,{value:r}])=>(e[t]=r,e)),{}):{}}(e),p=function(e,t){const a={},c={},s={};Object.entries(e.props||{}).filter((e=>"api_result_property"===e[1].type)).forEach((([e,{fallback:r,convertor:n,stateID:o}])=>{s[e]=r,a[e]=n,c[e]=t.statesHubAPI.getState$(o)}));const i=r(s),[l,p]=n((()=>Object.entries(c).reduce(((e,[t,r])=>(e[t]=Ne({state:r.getValue().result,convertor:a[t],fallback:i.current[t],propName:t}),e)),{})));return o((()=>{const e=Object.entries(c).reduce(((e,[t,r])=>(e[t]=r.pipe(E("result"),d((({result:e})=>Ne({state:e,convertor:a[t],fallback:i.current[t],propName:t}))),k((e=>{i.current[t]=e}))),e)),{}),t=j(e).pipe(w(1)).subscribe(p);return()=>t.unsubscribe()}),[]),l}(e,t),u=function(e,t){const r={};Object.entries(e.props||{}).filter((e=>"api_loading_property"===e[1].type)).forEach((([e,{stateID:n}])=>{r[e]=t.statesHubAPI.getState$(n)}));const[a,c]=n((()=>Object.entries(r).reduce(((e,[t,r])=>(e[t]=r.getValue().loading,e)),{})));return o((()=>{const e=Object.entries(r).reduce(((e,[t,r])=>(e[t]=r.pipe(w(1),E("loading"),d((({loading:e})=>e))),e)),{}),t=j(e).subscribe(c);return()=>t.unsubscribe()}),[]),a}(e,t),f=function(e,t){const a={},c={},s={};Object.entries(e.props||{}).filter((e=>"shared_state_property"===e[1].type||"node_state_property"===e[1].type)).forEach((([e,r])=>{"shared_state_property"===r.type?(c[e]=t.statesHubShared.getState$(r.stateID),a[e]=r.convertor):(c[e]=t.statesHubShared.getNodeState$(r.nodePath),a[e]=r.convertor),s[e]=r.fallback}));const i=r(s),[l,p]=n((()=>Object.entries(c).reduce(((e,[t,r])=>(e[t]=Ne({state:r.getValue(),convertor:a[t],fallback:i.current[t],propName:t}),e)),{})));return o((()=>{if(!Object.keys(c).length)return;const e=Object.entries(c).reduce(((e,[t,r])=>(e[t]=r.pipe(P(),d((e=>Ne({state:e,convertor:a[t],fallback:i.current[t],propName:t}))),k((e=>{i.current[t]=e}))),e)),{}),t=j(e).pipe(w(1)).subscribe(p);return()=>t.unsubscribe()}),[]),l}(e,t),b=function(e,t){const r=c(R);return a((()=>"supportStateExposure"in e&&e.supportStateExposure?{__exposeState:n=>{t.statesHubShared.exposeNodeState(`${r}/${e.id}`,n)}}:{}),[])}(e,t),m=He(e,t),y=function(e,t){const a={},c={},s={};Object.entries(e.props||{}).filter((e=>"inherited_property"===e[1].type)).forEach((([e,{fallback:r,convertor:n,parentID:o}])=>{var i;s[e]=r,a[e]=n,c[e]=null==(i=t.nodePropsCache)?void 0:i.getProps$(o)}));const i=r(s),[l,p]=n((()=>Object.entries(c).reduce(((e,[t,r])=>r?(e[t]=Ne({state:null==r?void 0:r.getValue(),convertor:a[t],fallback:i.current[t],propName:t}),e):(e[t]=i.current[t],e)),{})));return o((()=>{const e=Object.entries(c).reduce(((e,[t,r])=>r?(e[t]=r.pipe(d((e=>Ne({state:e,convertor:a[t],fallback:i.current[t],propName:t}))),k((e=>i.current[t]=e))),e):(e[t]=h(i.current[t]),e)),{}),t=j(e).pipe(w(1)).subscribe(p);return()=>t.unsubscribe()}),[]),l}(e,t),g=function(e){return a((()=>e.props?Object.entries(e.props).filter((e=>"functional_property"===e[1].type)).reduce(((t,[r,{func:n}])=>(t[r]=(...t)=>{try{n(...t)}catch(o){i.error(`an error occurred while run node '${e.id}' functional property:`,r,"with the following arguments:","\n",t,"\n","function is:","\n",n.toString(),"\n",o)}},t)),{}):{}),[])}(e),v=function(e,t){return a((()=>e.props?Object.entries(e.props).filter((e=>"shared_state_mutation_property"===e[1].type)).reduce(((e,[r,{stateID:n,convertor:o}])=>(e[r]=function(e){if("function"==typeof o)try{const r=o(e);t.statesHubShared.mutateState(n,r)}catch(e){i.error("failed to run convertor:\n",o.toString(),"\n",e)}else t.statesHubShared.mutateState(n,e)},e)),{}):{}),[])}(e,t),S=function(e,t){return a((()=>e.props?Object.entries(e.props).filter((e=>"api_invoke_property"===e[1].type)).reduce(((e,[r,{stateID:n,paramsBuilder:o,callback:a}])=>(i.warn("hook useAPIInvokeProps has been deprecated, please use hook useFuncProps instead"),e[r]=function(...e){try{const r=(null==o?void 0:o(...e))||{};t.apiStates[n].fetch(r,a)}catch(e){i.log("failed to run convertor or run action:",e)}},e)),{}):{}),[])}(e,t),x=Ie(e,t),$=function(e,t){return"isLink"in e&&e.isLink&&"html-element"===e.type&&"a"===e.name?{onClick:e=>{e.stopPropagation(),e.preventDefault();const r=e.currentTarget.href;r&&t.history.push(r)}}:{}}(e,t);return a((()=>{var r;const n=Object.assign(l,S,p,u,f,m,v,b,x,$,y);return null==(r=t.nodePropsCache)||r.setProps(s,e.id,n),Object.assign(n,g)}),[p,f,u,m,l])}function Ae({didMount:e,willUnmount:t}){o((()=>(null==e||e(),()=>{null==t||t()})),[])}function Le({node:e,ctx:r}){const a=De(e,r);Ae(e.lifecycleHooks||{});const s=c(R),l=function(){const[e,t]=n(null);return o((()=>{let e=!1;return System.import("react-jsx-parser").then((r=>{e||t((()=>r.default))})).catch((e=>{i.error("failed to load dependance react-jsx-parser:",e)})),()=>{e=!0}})),e}();return e.jsx?l?t.createElement(l,{bindings:a,renderInWrapper:!1,jsx:e.jsx,onError:e=>console.log(e)}):null:(i.error("jsx string is required,",`please check the spec of node: ${s}.`),null)}function Re({node:e,ctx:r}){Ae(e.lifecycleHooks||{});const a=function({schemaID:e,refLoader:t,orphan:r},a){const[s,l]=n(),p=c(R);return o((()=>{if(!e)return void i.error(`schemaID is required on RefNode, please check the spec for node: ${p}`);if(!t)return void i.error("refLoader is required on RefNode in order to get ref schema and corresponding APISpecAdapter,","please implement refLoader and pass it to parent RenderEngine.",`current RefNode path is: ${p}`);let n,o=!1;return t(e).then((({schema:e,plugins:t})=>{if(!o)return n=e,_e({plugins:t,schema:e,parentCTX:r?void 0:a})})).then((e=>{e&&n&&l({ctx:e.ctx,rootNode:e.rootNode})})).catch(i.error),()=>{o=!0}}),[]),s}({schemaID:e.schemaID,refLoader:r.plugins.refLoader,orphan:e.orphan},r);return a?t.createElement(nt,{node:a.rootNode,ctx:a.ctx}):e.fallback?t.createElement(nt,{node:e.fallback,ctx:r}):null}function Ce({node:e,ctx:r}){const n=De(e,r);Ae(e.lifecycleHooks||{});const o=c(R);return e.name?e.children&&e.children.length?t.createElement(e.name,n,t.createElement(rt,{nodes:e.children||[],ctx:r})):t.createElement(e.name,n):(i.error("name property is required in html node spec,",`please check the spec of node: ${o}.`),null)}function Fe(e,t){const r=c(R),n={type:"html-element",id:"dummyLoopContainer",name:"div",props:{iterable:e}},{iterable:o}=De(n,t);if(!Array.isArray(o)){const t=r.split("/").pop();return i.error("state is not iterable.",`LoopContainer node [${t}] require a array type state,`,`but got: ${o},`,"please check the follow property spec:\n",e),null}return o}function Ve(e,t,r){return"string"==typeof e||"number"==typeof e?e:void 0===e||"function"==typeof e||"boolean"==typeof e?r:"object"==typeof e&&null!==e?Reflect.get(e,t):r}function Ke(e,t,r,n){try{const o=r(e,t);return"object"==typeof o||o?o:(i.error("toProps result should be an object, but got: ${toPropsResult},",`please check the toProps spec of node: ${n},`,"the corresponding node will be skipped for render."),null)}catch(t){return i.error("An error occurred while calling toProps with the following parameter:",e,"\n",`please check the toProps spec of node: ${n},`,"the corresponding node will be skipped for render."),null}}function We({iterableState:e,loopKey:r,node:n,ctx:o,toProps:a}){const s=c(R),i=function({iterableState:e,toProps:t,otherProps:r,ctx:n,loopKey:o}){const a=Fe(e,n),s=c(R);return a?a.map(((e,n)=>{const a=Ke(e,n,t,s);if(!a)return null;const c=Object.entries(a).reduce(((e,[t,r])=>(e[t]={type:"constant_property",value:r},e)),{});return[Ve(e,o,n),Object.assign({},r,c)]})).filter((e=>!!e)):null}({iterableState:e,toProps:a,ctx:o,loopKey:r,otherProps:n.props});return i?t.createElement(t.Fragment,null,i.map((([e,r],a)=>{const c=Object.assign({},n,{props:r});return t.createElement(R.Provider,{value:`${s}/${a}`,key:e},t.createElement(nt,{key:e,node:c,ctx:o}))}))):null}function ze({packageName:e,exportName:t}){return System.import(e).then((e=>e[t||"default"])).catch((e=>(i.error("failed to load node component,",e),null)))}function Ue(e,{repository:t,componentLoader:r}){const a=c(R),[s,l]=n((()=>{if(t)return function(e,{packageName:t,packageVersion:r,exportName:n}){var o;return null==(o=e[`${t}@${r}`])?void 0:o[n||"default"]}(t,e)}));return o((()=>{if(s)return;let t=!1;return(r||ze)({packageName:e.packageName,packageVersion:e.packageVersion,exportName:e.exportName}).then((r=>{t||(r?l((()=>r)):i.error(`got empty component for package: ${e.packageName},`,`exportName: ${e.exportName}, version: ${e.packageVersion}`,`please check the spec for node: ${a}.`))})).catch(i.error),()=>{t=!0}}),[s]),s}function qe({outLayer:e,ctx:r,children:n}){const o=De(e,r);return t.createElement(e.name,o,n)}function Be({outLayer:e,ctx:r,children:n}){const o=De(e,r),a=Ue(e,r.plugins);return Ae(e.lifecycleHooks||{}),a?t.createElement(a,o,n):null}function Te({outLayer:e,ctx:r,children:n}){return"html-element"===(null==e?void 0:e.type)?t.createElement(qe,{outLayer:e,ctx:r},n):"react-component"===(null==e?void 0:e.type)?t.createElement(Be,{outLayer:e,ctx:r},n):t.createElement(t.Fragment,null,n)}function Me({node:e,composedState:r,ctx:n,index:o}){const s=function(e,t,r,n){const o=c(R);return a((()=>{const a=Ke(e,r,t,o),c=Object.entries(a||{}).reduce(((e,[t,r])=>(e[t]={type:"constant_property",value:r},e)),{});return Object.assign({},n,c)}),[e,n])}(r,e.toProps,o,e.props),i=Object.assign({},e,{props:s});return t.createElement(nt,{node:i,ctx:n})}function Je({iterableState:e,loopKey:r,node:n,ctx:o}){const a=c(R),s=Fe(e,o);return s?t.createElement(t.Fragment,null,s.map(((e,c)=>{const s=Ve(e,r,c);return t.createElement(R.Provider,{value:`${a}/${n.id}/${c}`,key:c},t.createElement(Te,{key:s,outLayer:n.outLayer,ctx:o},(n.nodes||n.children).map(((r,n)=>t.createElement(Me,{node:r,composedState:e,ctx:o,index:n,key:r.id})))))}))):null}function Xe({node:e,ctx:r}){Ae(e.lifecycleHooks||{});const{node:n}=e;return"composed-node"!==n.type&&"toProps"in e?t.createElement(We,{iterableState:e.iterableState,loopKey:e.loopKey,node:n,toProps:t=>e.toProps(t),ctx:r}):"composed-node"===n.type?t.createElement(Je,{iterableState:e.iterableState,loopKey:e.loopKey,node:n,ctx:r}):(i.error("Unrecognized loop node:",e),null)}const Ze=t.createContext("/");function Ge(e){return e.replace(/^\/|\/$/g,"")}function Qe(e){return/^:[a-zA-Z_][[a-zA-Z_$0-9]+$/.test(e)}function Ye(e,t,r){const[a,c]=n(!1);return o((()=>{const n=e.pipe(d((({pathname:e})=>r?function(e,t){const r=e.split("/"),n=t.split("/");return r.length===n.length&&r.every(((e,t)=>!!Qe(n[t])||e===n[t]))}(e,t):function(e,t){const r=e.split("/"),n=t.split("/");return!(r.length<n.length)&&n.every(((e,t)=>!!Qe(e)||e===r[t]))}(e,t))),P()).subscribe(c);return()=>n.unsubscribe()}),[]),a}function et({node:e,ctx:r}){var n;Ae(e.lifecycleHooks||{});const o=c(Ze),a=(s=o,i=e.path,"/"===s?`/${Ge(i)}`:`${s}/${Ge(i)}`);var s,i;return Ye(r.location$,a,null!=(n=e.exactly)&&n)?t.createElement(Ze.Provider,{value:a},t.createElement(nt,{node:e.node,ctx:r})):null}function tt({node:e,ctx:r}){const n=De(e,r),o=Ue(e,r.plugins);return Ae(e.lifecycleHooks||{}),o?e.children&&e.children.length?t.createElement(o,n,t.createElement(rt,{nodes:e.children||[],ctx:r})):t.createElement(o,n):null}function rt({nodes:e,ctx:r}){return e.length?t.createElement(t.Fragment,null,e.map((e=>t.createElement(nt,{key:e.id,node:e,ctx:r})))):null}function nt({node:e,ctx:r}){const n=`${c(R)}/${e.id}`,o=function(e,t){const r=e.shouldRender,n={id:"placeholder-node",type:"html-element",name:"div",props:r?{shouldRender:r}:void 0},{shouldRender:o}=De(n,t);return!r||("api_loading_property"===r.type&&r.revert?!o:!!o)}(e,r);return o?"route-node"===e.type?t.createElement(R.Provider,{value:n},t.createElement(et,{node:e,ctx:r})):"loop-container"===e.type?t.createElement(R.Provider,{value:n},t.createElement(Xe,{node:e,ctx:r})):"html-element"===e.type?t.createElement(R.Provider,{value:n},t.createElement(Ce,{node:e,ctx:r})):"react-component"===e.type?t.createElement(R.Provider,{value:n},t.createElement(tt,{node:e,ctx:r})):"ref-node"===e.type?t.createElement(R.Provider,{value:n},t.createElement(Re,{node:e,ctx:r})):"jsx-node"===e.type?t.createElement(R.Provider,{value:n},t.createElement(Le,{node:e,ctx:r})):(i.error("Unrecognized node type of node:",e),null):null}e("SchemaRender",t.forwardRef((function({schema:e,plugins:r},a){const{ctx:c,rootNode:l}=function(e,t){const[r,a]=n();return o((()=>{let r=!1;return _e({schema:e,plugins:t}).then((e=>{r||a(e)})).catch(i.error),()=>{r=!0}}),[]),r}(e,r)||{};return s(a,(()=>{if(c)return{apiStates:c.apiStates,states:c.states,history:c.history}}),[c]),c&&l?t.createElement(nt,{node:l,ctx:c}):null})));class ot{constructor(e,t){this.schema=e,this.plugins=t||{}}async render(e){const{ctx:r,rootNode:n}=await _e({plugins:this.plugins,schema:this.schema});L.render(t.createElement(nt,{node:n,ctx:r}),e)}}e({RenderEngine:ot,default:ot})}}}));
