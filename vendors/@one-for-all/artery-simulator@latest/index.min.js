System.register(["react","rxjs","@one-for-all/utils"],(function(e,t){"use strict";var n,r,s,i,o,a,c,u,p,d,m,l,h,f,g,b,w;return{setters:[function(e){n=e.default,r=e.useState,s=e.useEffect,i=e.useRef,o=e.useImperativeHandle},function(e){a=e.Subject,c=e.filter,u=e.switchMap,p=e.from,d=e.map,m=e.interval,l=e.tap,h=e.takeUntil,f=e.take,g=e.find,b=e.noop},function(e){w=e.logger}],execute:function(){var y={exports:{}};
/*!
			  Copyright (c) 2018 Jed Watson.
			  Licensed under the MIT License (MIT), see
			  http://jedwatson.github.io/classnames
			*/!function(e){!function(){var t={}.hasOwnProperty;function n(){for(var e=[],r=0;r<arguments.length;r++){var s=arguments[r];if(s){var i=typeof s;if("string"===i||"number"===i)e.push(s);else if(Array.isArray(s)){if(s.length){var o=n.apply(null,s);o&&e.push(o)}}else if("object"===i)if(s.toString===Object.prototype.toString)for(var a in s)t.call(s,a)&&s[a]&&e.push(a);else e.push(s.toString())}}return e.join(" ")}e.exports?(n.default=n,e.exports=n):window.classNames=n}()}(y);var v=y.exports,x=new URL("assets/simulator-6e4c03e3.js",t.meta.url).href;class E{constructor(e,t){if(this.seq=0,this.connected=!1,this.responderMap={},this.target=e,this.name=t,this.send$=new a,this.receive$=new a,window===e)throw new Error("Messenger: target can not be same as current window");this.isSubWin=window.parent===e,window.addEventListener("message",(e=>{if(e.origin!==window.origin)return;if(this.name===e.data.name)return;const t=performance.now();this.receive$.next(e.data);const n=performance.now()-t;n>10&&w.log(this.name,"execute on message cost:",n,"message type:",e.data.type)})),this.send$.subscribe((e=>{this.target.postMessage(e,window.origin)}))}addResponders(e){Object.entries(e).forEach((([e,t])=>{const n=this.receive$.pipe(c((t=>!!t.type&&t.type===e)),u((({message:e,seq:n})=>p(Promise.all([t(e),Promise.resolve(n)])))),d((([t,n])=>({type:`echo_${e}`,message:t,echoSeq:n,seq:this.nextSeq(),name:this.name})))).subscribe(this.send$);this.responderMap[e]&&this.responderMap[e].unsubscribe(),this.responderMap[e]=n}))}waitForReady(){return new Promise(((e,t)=>{let n;const r=setTimeout((()=>{null==n||n.unsubscribe(),t(new Error(`${this.name} messenger connection timeout`))}),5e3);this.isSubWin?n=m(200).pipe(l((()=>this.send("ping","ping"))),h(this.listen("ping"))).subscribe({complete:()=>{null==n||n.unsubscribe(),clearTimeout(r),this.connected=!0,e()}}):this.listen("ping").pipe(f(1)).subscribe((()=>{this.send("ping","ping"),clearTimeout(r),this.connected=!0,e()}))}))}nextSeq(){return this.seq=this.seq+1,this.seq}send(e,t){this.send$.next({type:e,message:t,seq:this.nextSeq(),name:this.name})}listen(e){return this.receive$.pipe(c((t=>!!t.type&&t.type===e)),d((({message:e})=>e)))}request(e,t){const n=this.nextSeq(),r=new Promise(((t,r)=>{const s=setTimeout((()=>{r(new Error(`messenger request timeout, request message type is: ${e}`))}),5e3),i=this.receive$.pipe(g((({echoSeq:e})=>e===n))).subscribe((e=>{i.unsubscribe(),clearTimeout(s),e?t(e.message):r(new Error("fatal"))}))}));return this.send$.next({type:e,message:t,seq:n,name:this.name}),r}}function S(e,t,n){var r,s,i;e.contentWindow&&(e.contentWindow.__fenceIframeLoad=()=>{null==n||n()}),null==(r=e.contentDocument)||r.open(),null==(s=e.contentDocument)||s.write(`\n  <!DOCTYPE html>\n  <html lang="en">\n  <head>\n    <meta charset="UTF-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Document</title>\n    <script>\n      window.onload = (event) => {\n        if (window.__fenceIframeLoad) {\n          window.__fenceIframeLoad();\n        }\n      };\n    <\/script>\n    ${function(e){const t=document.createElement("div");return e.forEach((e=>{const n=document.createElement(e.name);Object.entries(e.attrs).forEach((([e,t])=>{n.setAttribute(e,t)})),e.innerText&&(n.innerHTML=e.innerText),t.appendChild(n)})),t.innerHTML}(t)}\n  </head>\n  <body>\n  </body>\n  </html>\n  `),null==(i=e.contentDocument)||i.close()}var _=n.forwardRef((function({headElements:e,onLoad:t},i){const[o,a]=r();return s((()=>{o&&S(o,e,t)}),[o]),n.createElement("iframe",{className:"simulator-fence",ref:e=>{e&&("function"==typeof i?i(e):i&&"current"in i&&(i.current=e),a(e))}})}));const T="artery",q="active_node",$="active_over_layer_node_id";var N=[],O=[];function R(e,t){const n=Array.from(document.scripts).filter((e=>"systemjs-importmap"===e.type)).map((e=>JSON.parse(e.innerText))).map((e=>JSON.stringify(e))).map((e=>({name:"script",attrs:{type:"systemjs-importmap"},innerText:e}))),r=e.startsWith("http")?e:`${window.origin}${e}`,s=n.concat([{name:"script",attrs:{type:"systemjs-importmap"},innerText:`{\n        "imports": {\n          "TEMPORARY_PATCH_FOR_ARTERY_PLUGINS": "${r}"\n        }\n      }`},{name:"script",attrs:{src:"https://ofapkg.pek3b.qingstor.com/system@6.10.3/system.6.10.3.min.js"}},{name:"script",attrs:{src:x}}]),i=(t||[]).map((e=>({name:"link",attrs:{rel:"stylesheet",href:e}})));return s.concat(i)}!function(e,t){if(e&&"undefined"!=typeof document){var n,r=!0===t.prepend?"prepend":"append",s=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(s){var o=N.indexOf(i);-1===o&&(o=N.push(i)-1,O[o]={}),n=O[o]&&O[o][r]?O[o][r]:O[o][r]=a()}else n=a();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function a(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var n=Object.keys(t.attributes),s=0;s<n.length;s++)e.setAttribute(n[s],t.attributes[n[s]]);var o="prepend"===r?"afterbegin":"beforeend";return i.insertAdjacentElement(o,e),e}}(".artery-simulator {\n  position: relative;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-columns: 1fr;\n  padding: 16px;\n}\n\n.simulator-fence {\n  width: 100%;\n  height: 100%;\n  background-color: white;\n  border: none;\n  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.11), 0 2px 2px rgba(0, 0, 0, 0.11), 0 4px 4px rgba(0, 0, 0, 0.11), 0 6px 8px rgba(0, 0, 0, 0.11), 0 8px 16px rgba(0, 0, 0, 0.11);\n}",{});e("default",n.forwardRef((function({activeOverLayerNodeID:e,activeNode:t,artery:a,className:c,cssURLs:u,isNodeSupportChildren:p,onChange:d,pluginsSrc:m,setActiveOverLayerNodeID:l,setActiveNode:h,overLayerComponents:f},g){const w=i(null),[y,x]=r(),[S,N]=r(!1);return o(g,(()=>({iframe:w.current||null}))),s((()=>{var e,t;if(!(null==(e=w.current)?void 0:e.contentWindow)||!S)return;const n=new E(null==(t=w.current)?void 0:t.contentWindow,"host-side");n.waitForReady().then((()=>{n.send(T,a)})).catch(b),x(n),w.current.contentWindow.__OVER_LAYER_COMPONENTS=f}),[S]),function(e,t){s((()=>{e&&e.addResponders({check_node_support_children:t})}),[t,e])}(y,p),function(e,t,n){s((()=>{if(!e)return;const n=e.listen(T).subscribe((e=>{t(e)}));return()=>{n.unsubscribe()}}),[t,e]),s((()=>{e&&e.send(T,n)}),[n,e])}(y,d,a),function(e,t,n){const r=i();s((()=>{if(!e)return;const n=e.listen(q).subscribe((e=>{t(e)}));return()=>{n.unsubscribe()}}),[t,e]),s((()=>{e&&r.current!==(null==n?void 0:n.id)&&(e.send(q,n),r.current=null==n?void 0:n.id)}),[n,e])}(y,h,t),function(e,t,n){s((()=>{if(!e)return;const n=e.listen($).subscribe((e=>{t(e)}));return()=>{n.unsubscribe()}}),[t,e]),s((()=>{e&&e.send($,n)}),[n,e])}(y,l,e),n.createElement("div",{className:v("artery-simulator",c)},n.createElement(_,{ref:w,headElements:R(m,u),onLoad:()=>N(!0)}))})))}}}));
