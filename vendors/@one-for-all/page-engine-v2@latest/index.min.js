System.register(["react","react-dom","rxjs","@one-for-all/render-engine"],(function(e){"use strict";var t,n,r,o,u,c,a,i,l,s,f,d;return{setters:[function(e){t=e.useState,n=e.useEffect,r=e.createContext,o=e.useMemo,u=e.useContext,c=e.useCallback,a=e.default,i=e.Fragment,l=e.useRef},function(e){s=e.default},function(e){f=e.BehaviorSubject},function(e){d=e.default}],execute:function(){function p(e,r){const[o,u]=t(r);return n((()=>{if(e){const t=e.subscribe(u);return()=>t.unsubscribe()}}),[e]),null!=o?o:r}e({RenderSchema:function({schema:e,elementId:t}){const r=new d(e);return n((()=>{const e=document.getElementById(t);e&&r.render(e).catch((()=>{}))}),[]),a.createElement("div",{id:t,style:{display:"unset"}})},getNodeParentPathFromSchemaByNodeId:Fe,loadComponentsFromSchema:async function(e){const t=[];Me(e,(e=>t.push(e)));const n=t.map((async e=>{const t=`${e.id}`;if("react-component"===e.type){return{id:t,Render:await Be(e,(()=>null))}}return!1})).filter(Boolean);return await Promise.all(n)},loadPackage:Be,removeAllNodeFromSchema:Qe,removeNodeFromSchemaByNodeId:qe,schemaNodeWithChildren:ze,schemaNodeWithNode:Ke,traverseSchema:Me,useCanvasCommand:function({schema:e,onChange:t,blocksCommunicationState$:n}){const r=rt();return r.registry({name:"delete",keyboard:["delete","backspace","ctrl+d"],execute(){const r=Oe(e),{activeNodeID:o}=n.getValue();if(!o)return{};const u=qe(e,o);return{redo(){t(u),n.next(nt(tt({},n.getValue()),{activeNodeID:""}))},undo(){t(r),n.next(nt(tt({},n.getValue()),{activeNodeID:o}))}}}}),r.registry({name:"clear",keyboard:["ctrl+c"],execute(){const r=Oe(e),o=Qe(e),{activeNodeID:u}=n.getValue();return{redo(){t(o),n.next(nt(tt({},n.getValue()),{activeNodeID:""}))},undo(){t(r),n.next(nt(tt({},n.getValue()),{activeNodeID:u}))}}}}),r},useCommand:rt});var y=Object.defineProperty,h=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(e,t,n)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,v=(e,t)=>{for(var n in t||(t={}))m.call(t,n)&&b(e,n,t[n]);if(h)for(var n of h(t))g.call(t,n)&&b(e,n,t[n]);return e};function w(e){return new f(e)}const S=function(){const e={};return t=>{const n=e[t];if(n)return n;const o=r(w({}));return e[t]=o,o}}();function O(e){const{gridColumnStart:t,gridColumnEnd:n,gridRowStart:r,gridRowEnd:i,render:l,engineId:s,setLayer:f}=e,d=o((()=>S(s)),[s]),y=u(d),{schemaStore$:h,blocksCommunicationState$:m}=p(y,{schemaStore$:y.value.schemaStore$}),g=p(h,void 0),b={gridColumnStart:t,gridColumnEnd:n,gridRowStart:r,gridRowEnd:i},v=c((e=>{!function(e,t){null==e||e.next(t)}(h,e)}),[h,g]);return g&&m?a.createElement("div",{className:"page-engine-layer-block",style:b},a.createElement(l,{schema:g,onChange:v,blocksCommunicationState$:m,engineId:s,setLayer:f})):null}function x(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}x(".page-engine-layer {\n  position: fixed;\n  left: 20px;\n  right: 20px;\n  bottom: 20px;\n  top: 20px;\n  box-shadow: 0 0 1000px 1px blue;\n  border-radius: 5px;\n  overflow: hidden;\n}");var j=Object.defineProperty,E=Object.defineProperties,I=Object.getOwnPropertyDescriptors,k=Object.getOwnPropertySymbols,N=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable,C=(e,t,n)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function $(e){const{blocks:t,gridTemplateColumns:r,gridTemplateRows:c,zIndex:i,engineId:l,blocksCommunicationStateInitialValue:s,setLayer:d}=e,p=o((()=>S(l)),[l]),y=u(p),h=o((()=>new f(s)),[s]);n((()=>{var e,t;t={blocksCommunicationState$:h},(e=y).next(v(v({},e.value),t))}),[h]);const m={display:"grid",gap:"1px",gridTemplateColumns:r,gridTemplateRows:c,zIndex:i};return a.createElement("div",{className:"page-engine-layer",style:m},t.filter((({visible:e})=>!1!==e)).map(((e,t)=>{return a.createElement(O,(n=((e,t)=>{for(var n in t||(t={}))N.call(t,n)&&C(e,n,t[n]);if(k)for(var n of k(t))P.call(t,n)&&C(e,n,t[n]);return e})({},e),E(n,I({key:t,engineId:l,setLayer:d}))));var n})))}function L(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function A(e){return function t(n){return 0===arguments.length||L(n)?t:e.apply(this,arguments)}}function D(e){return function t(n,r){switch(arguments.length){case 0:return t;case 1:return L(n)?t:A((function(t){return e(n,t)}));default:return L(n)&&L(r)?t:L(n)?A((function(t){return e(t,r)})):L(r)?A((function(t){return e(n,t)})):e(n,r)}}}function R(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,r){return t.apply(this,arguments)};case 4:return function(e,n,r,o){return t.apply(this,arguments)};case 5:return function(e,n,r,o,u){return t.apply(this,arguments)};case 6:return function(e,n,r,o,u,c){return t.apply(this,arguments)};case 7:return function(e,n,r,o,u,c,a){return t.apply(this,arguments)};case 8:return function(e,n,r,o,u,c,a,i){return t.apply(this,arguments)};case 9:return function(e,n,r,o,u,c,a,i,l){return t.apply(this,arguments)};case 10:return function(e,n,r,o,u,c,a,i,l,s){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function T(e,t,n){return function(){for(var r=[],o=0,u=e,c=0;c<t.length||o<arguments.length;){var a;c<t.length&&(!L(t[c])||o>=arguments.length)?a=t[c]:(a=arguments[o],o+=1),r[c]=a,L(a)||(u-=1),c+=1}return u<=0?n.apply(this,r):R(u,T(e,r,n))}}var V=D((function(e,t){return 1===e?A(t):R(e,T(e,[],t))}));function B(e){return function t(n,r,o){switch(arguments.length){case 0:return t;case 1:return L(n)?t:D((function(t,r){return e(n,t,r)}));case 2:return L(n)&&L(r)?t:L(n)?D((function(t,n){return e(t,r,n)})):L(r)?D((function(t,r){return e(n,t,r)})):A((function(t){return e(n,r,t)}));default:return L(n)&&L(r)&&L(o)?t:L(n)&&L(r)?D((function(t,n){return e(t,n,o)})):L(n)&&L(o)?D((function(t,n){return e(t,r,n)})):L(r)&&L(o)?D((function(t,r){return e(n,t,r)})):L(n)?A((function(t){return e(t,r,o)})):L(r)?A((function(t){return e(n,t,o)})):L(o)?A((function(t){return e(n,r,t)})):e(n,r,o)}}}var M=Array.isArray||function(e){return null!=e&&e.length>=0&&"[object Array]"===Object.prototype.toString.call(e)};function F(e){return null!=e&&"function"==typeof e["@@transducer/step"]}function q(e,t,n){return function(){if(0===arguments.length)return n();var r=Array.prototype.slice.call(arguments,0),o=r.pop();if(!M(o)){for(var u=0;u<e.length;){if("function"==typeof o[e[u]])return o[e[u]].apply(o,r);u+=1}if(F(o)){var c=t.apply(null,r);return c(o)}}return n.apply(this,arguments)}}var z=function(){return this.xf["@@transducer/init"]()},K=function(e){return this.xf["@@transducer/result"](e)};function Q(e){return"[object String]"===Object.prototype.toString.call(e)}var W=A((function(e){return!!M(e)||!!e&&("object"==typeof e&&(!Q(e)&&(1===e.nodeType?!!e.length:0===e.length||e.length>0&&(e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1)))))})),U=function(){function e(e){this.f=e}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(e){return e},e.prototype["@@transducer/step"]=function(e,t){return this.f(e,t)},e}();var X=D((function(e,t){return R(e.length,(function(){return e.apply(t,arguments)}))})),G=X;function H(e,t,n){for(var r=n.next();!r.done;){if((t=e["@@transducer/step"](t,r.value))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}r=n.next()}return e["@@transducer/result"](t)}function J(e,t,n,r){return e["@@transducer/result"](n[r](G(e["@@transducer/step"],e),t))}var Y="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function Z(e,t,n){if("function"==typeof e&&(e=function(e){return new U(e)}(e)),W(n))return function(e,t,n){for(var r=0,o=n.length;r<o;){if((t=e["@@transducer/step"](t,n[r]))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}r+=1}return e["@@transducer/result"](t)}(e,t,n);if("function"==typeof n["fantasy-land/reduce"])return J(e,t,n,"fantasy-land/reduce");if(null!=n[Y])return H(e,t,n[Y]());if("function"==typeof n.next)return H(e,t,n);if("function"==typeof n.reduce)return J(e,t,n,"reduce");throw new TypeError("reduce: list must be array or iterable")}var _=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=z,e.prototype["@@transducer/result"]=K,e.prototype["@@transducer/step"]=function(e,t){return this.xf["@@transducer/step"](e,this.f(t))},e}(),ee=D((function(e,t){return new _(e,t)}));function te(e,t){return Object.prototype.hasOwnProperty.call(t,e)}var ne=Object.prototype.toString,re=function(){return"[object Arguments]"===ne.call(arguments)?function(e){return"[object Arguments]"===ne.call(e)}:function(e){return te("callee",e)}}(),oe=re,ue=!{toString:null}.propertyIsEnumerable("toString"),ce=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],ae=function(){return arguments.propertyIsEnumerable("length")}(),ie=function(e,t){for(var n=0;n<e.length;){if(e[n]===t)return!0;n+=1}return!1},le="function"!=typeof Object.keys||ae?A((function(e){if(Object(e)!==e)return[];var t,n,r=[],o=ae&&oe(e);for(t in e)!te(t,e)||o&&"length"===t||(r[r.length]=t);if(ue)for(n=ce.length-1;n>=0;)te(t=ce[n],e)&&!ie(r,t)&&(r[r.length]=t),n-=1;return r})):A((function(e){return Object(e)!==e?[]:Object.keys(e)})),se=D(q(["fantasy-land/map","map"],ee,(function(e,t){switch(Object.prototype.toString.call(t)){case"[object Function]":return V(t.length,(function(){return e.call(this,t.apply(this,arguments))}));case"[object Object]":return Z((function(n,r){return n[r]=e(t[r]),n}),{},le(t));default:return function(e,t){for(var n=0,r=t.length,o=Array(r);n<r;)o[n]=e(t[n]),n+=1;return o}(e,t)}}))),fe=se,de=Number.isInteger||function(e){return e<<0===e},pe=D((function(e,t){var n=e<0?t.length+e:e;return Q(t)?t.charAt(n):t[n]})),ye=D((function(e,t){return e.map((function(e){for(var n,r=t,o=0;o<e.length;){if(null==r)return;n=e[o],r=de(n)?pe(n,r):r[n],o+=1}return r}))})),he=D((function(e,t){return ye([e],t)[0]})),me=B((function(e,t,n){var r={};for(var o in n)r[o]=n[o];return r[e]=t,r})),ge=A((function(e){return null==e})),be=B((function e(t,n,r){if(0===t.length)return n;var o=t[0];if(t.length>1){var u=!ge(r)&&te(o,r)?r[o]:de(t[1])?[]:{};n=e(Array.prototype.slice.call(t,1),n,u)}if(de(o)&&M(r)){var c=[].concat(r);return c[o]=n,c}return me(o,n,r)})),ve=be;var we=A((function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}));function Se(e,t,n,r){var o,u=function(o){for(var u=t.length,c=0;c<u;){if(e===t[c])return n[c];c+=1}for(var a in t[c+1]=e,n[c+1]=o,e)o[a]=r?Se(e[a],t,n,!0):e[a];return o};switch(we(e)){case"Object":return u({});case"Array":return u([]);case"Date":return new Date(e.valueOf());case"RegExp":return o=e,new RegExp(o.source,(o.global?"g":"")+(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.sticky?"y":"")+(o.unicode?"u":""));default:return e}}var Oe=A((function(e){return null!=e&&"function"==typeof e.clone?e.clone():Se(e,[],[],!0)})),xe=D((function(e,t){return function(n){return function(r){return fe((function(e){return t(e,r)}),n(e(r)))}}})),je=A((function(e){return xe(he(e),ve(e))})),Ee=function(e){return{value:e,map:function(t){return Ee(t(e))}}},Ie=B((function(e,t,n){return e((function(e){return Ee(t(e))}))(n).value})),ke=Ie;var Ne=Object.defineProperty,Pe=Object.defineProperties,Ce=Object.getOwnPropertyDescriptors,$e=Object.getOwnPropertySymbols,Le=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable,De=(e,t,n)=>t in e?Ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function Re({layersStore$:e,engineId:t}){const n=p(e,[]);function r(t){return r=>{!function(e,t,n){!function(e,t){e.next(t)}(e,ke(je([n]),(()=>t),e.value))}(e,r(n[t]),t)}}return a.createElement(i,null,n.map(((e,n)=>{return a.createElement($,(o=((e,t)=>{for(var n in t||(t={}))Le.call(t,n)&&De(e,n,t[n]);if($e)for(var n of $e(t))Ae.call(t,n)&&De(e,n,t[n]);return e})({},e),u={key:n,zIndex:n,engineId:t,setLayer:r(n)},Pe(o,Ce(u))));var o,u})))}let Te=e=>crypto.getRandomValues(new Uint8Array(e));const Ve=e("uuid",((e,t=21)=>((e,t,n)=>{let r=(2<<Math.log(e.length-1)/Math.LN2)-1,o=-~(1.6*r*t/e.length);return(u=t)=>{let c="";for(;;){let t=n(o),a=o;for(;a--;)if(c+=e[t[a]&r]||"",c.length===u)return c}}})(e,t,Te))("1234567890qwertyuioplkjhgfdsazxcvbnmQWERTYUIOPLKJHGFDSAZXCVBNM",8));async function Be({packageName:e,packageVersion:t,exportName:n},r){try{const r=t?`${e}@${t}`:e;return(await System.import(r))[n]}catch(e){return r}}function Me(e,t,n=0,r,o){var u;const{node:c}=e;t(c,{level:n,parentNode:r,path:null!=o?o:"node"}),ze(c)&&(null==(u=c.children)||u.forEach(((e,r)=>{Me({node:e},t,n+1,c,`${null!=o?o:"node"}.children.${r}`)}))),Ke(c)&&"composed-node"!==c.node.type&&Me({node:c.node},t,n+1,c,`${null!=o?o:"node"}.node`)}function Fe(e,t){let n;return Me(e,((e,{path:r})=>{e.id===t&&(n=r)})),n?n.split(".").slice(0,-1).join("."):void 0}function qe(e,t){const n=Fe(e,t);return n?ke(je(n.split(".")),(e=>e.filter((e=>e.id!==t))),e):e}function ze(e){return"html-element"===e.type||"react-component"===e.type}function Ke(e){return"loop-container"===e.type||"route-node"===e.type}function Qe(e){const t=[];return Me(e,((e,{level:n,parentNode:r,path:o})=>{r&&ze(r)&&t.push(`${e.id}`)})),t.reduce(((e,t)=>qe(e,t)),e)}function We({schema:e,layers:t,setSchemaStore:r,setLayersStore:u,engineId:c}){const i=o((()=>function(e){return new f(e)}(e)),[e]),l=o((()=>function(e){return new f(null!=e?e:[])}(t)),[t]),s=o((()=>w({schemaStore$:i})),[i]),d=o((()=>S(c)),[c]);return n((()=>{r(i)}),[i]),n((()=>{u(l)}),[l]),a.createElement(d.Provider,{value:s},a.createElement(Re,{layersStore$:l,engineId:c}))}x("html, body {\n  height: 100%;\n  width: 100%;\n  margin: 0;\n  padding: 0;\n}");const Ue=class{constructor(e,t){this.setSchemaStore=e=>{this.schemaStore$=e},this.setLayersStore=e=>{this.layerStore$=e},this.render=e=>{s.render(a.createElement(We,{schema:this.schema,layers:this.layers,setSchemaStore:this.setSchemaStore,setLayersStore:this.setLayersStore,engineId:this.engineId}),document.getElementById(e))},this.schema=e,this.layers=t,this.engineId=Ve(),Ue.instanceMap[this.engineId]=this}static useLayers(e){const t=Ue.instanceMap[e];return p(t.layerStore$,[])}static registryLayers(e,t){return function(e,t){t.forEach((t=>function(e,t){e.next([...e.value,t])}(e,t)))}(Ue.instanceMap[e].layerStore$,t)}};let Xe=e("default",Ue);Xe.instanceMap={},Xe.useObservable=p,Xe.useSchema=e=>{const t=Ue.instanceMap[e];return n=t.schemaStore$,r=t.schema,p(n,r);var n,r};var Ge=Object.defineProperty,He=Object.defineProperties,Je=Object.getOwnPropertyDescriptors,Ye=Object.getOwnPropertySymbols,Ze=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable,et=(e,t,n)=>t in e?Ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tt=(e,t)=>{for(var n in t||(t={}))Ze.call(t,n)&&et(e,n,t[n]);if(Ye)for(var n of Ye(t))_e.call(t,n)&&et(e,n,t[n]);return e},nt=(e,t)=>He(e,Je(t));function rt(){const e=l({current:-1,queue:[],commands:[],commandName2Execute:{},destroyList:[]}),t=c((t=>{const{commands:n,commandName2Execute:r,queue:o,current:u}=e.current;if(r[t.name]){const e=n.findIndex((e=>e.name===t.name));n.splice(e,1)}n.push(t),r[t.name]=(...n)=>{const{redo:r,undo:c}=t.execute(...n);r&&(r(),!1!==t.followQueue&&(o.length&&(e.current.queue=o.slice(0,u+1)),e.current.queue.push({redo:r,undo:c}),e.current.current=u+1))}}),[]),r=c((t=>{const{key:n,shiftKey:r,altKey:o,ctrlKey:u,metaKey:c}=t,a=[];(u||c)&&a.push("ctrl"),r&&a.push("shift"),o&&a.push("alt"),a.push(n.toLowerCase());const i=a.join("+");e.current.commands.forEach((n=>{if(!n.keyboard)return;(Array.isArray(n.keyboard)?n.keyboard:[n.keyboard]).includes(i)&&(e.current.commandName2Execute[n.name](),t.stopPropagation(),t.preventDefault())}))}),[]),o=c((()=>{n((()=>{const{commands:n,destroyList:r}=e.current;n.forEach((e=>{const t=e.init;t&&r.push(t())})),t({name:"undo",keyboard:["ctrl+z"],followQueue:!1,execute:()=>({redo:()=>{var t,n;const{current:r,queue:o}=e.current;-1!==r&&(null==(n=(t=o[r]).undo)||n.call(t),e.current.current--)}})}),t({name:"redo",keyboard:["ctrl+y","ctrl+shift+z"],followQueue:!1,execute:()=>({redo:()=>{var t,n;const{current:r,queue:o}=e.current;r!==o.length-1&&(null==(n=(t=o[r+1]).redo)||n.call(t),e.current.current++)}})})}),[])}),[]);return n((()=>(window.addEventListener("keydown",r,!0),()=>{window.removeEventListener("keydown",r,!0),e.current.destroyList.forEach((e=>null==e?void 0:e()))})),[]),{registry:t,useInit:o,commands:e.current.commandName2Execute}}}}}));
